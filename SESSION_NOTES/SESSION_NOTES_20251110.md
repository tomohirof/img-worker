# ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆ - 2025å¹´11æœˆ10æ—¥

## æœ¬æ—¥ã®å®Ÿæ–½å†…å®¹

### 1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„

#### POST /renderã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
- **å ´æ‰€**: `src/index.tsx:522-604`
- **å†…å®¹**:
  - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¨ä½“ã‚’try-catchãƒ–ãƒ­ãƒƒã‚¯ã§å›²ã‚“ã 
  - JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã‚’400ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦é©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼ã‚’500ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦è¿”å´ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ­ã‚°å‡ºåŠ›
  - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ—¥æœ¬èªã§åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤º

#### ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿é–¢æ•°ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
- **å ´æ‰€**: `src/index.tsx:30-82`
- **å†…å®¹**:
  - `loadFont()`é–¢æ•°ã«try-catchãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ 
  - `ensureFontsLoaded()`é–¢æ•°ã«ã‚‚try-catchãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ 
  - ã‚¨ãƒ©ãƒ¼æ™‚ã«è©³ç´°ãªãƒ­ã‚°ã‚’å‡ºåŠ›ï¼ˆãƒ•ã‚©ãƒ³ãƒˆåã€weightãªã©ã®æƒ…å ±å«ã‚€ï¼‰
  - HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚‚å«ã‚ãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ”¹å–„
  - åˆ†ã‹ã‚Šã‚„ã™ã„æ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”å´

#### å‹å®šç¾©ã®ä¿®æ­£
- **å ´æ‰€**: `src/index.tsx:84`
- **å†…å®¹**: Honoå‹å®šç¾©ã®`Env`ã‚’`Bindings`ã«ä¿®æ­£

### 2. ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã¨å‹•ä½œç¢ºèª
- `wrangler deploy --dry-run --outdir=dist` ã§ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½
- ãƒ“ãƒ«ãƒ‰æˆåŠŸã‚’ç¢ºèª

### 3. ã‚³ãƒŸãƒƒãƒˆ
- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `83b15e8`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `refactor: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ã¨Bindingså‹ã®ä¿®æ­£`
- **å¤‰æ›´å†…å®¹**:
  - POST /renderã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¨ä½“ã«try-catchãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ 
  - loadFont()ã¨ensureFontsLoaded()ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 
  - Honoå‹å®šç¾©ã®Envã‚’Bindingsã«ä¿®æ­£

## æŠ€è¡“çš„ãªè©³ç´°

### è¿½åŠ ã—ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼**:
   ```typescript
   if (error instanceof SyntaxError) {
     return c.json({
       error: 'BAD_REQUEST',
       message: 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®JSONãŒä¸æ­£ã§ã™'
     }, 400)
   }
   ```

2. **ä¸€èˆ¬çš„ãªã‚¨ãƒ©ãƒ¼**:
   ```typescript
   return c.json({
     error: 'INTERNAL_SERVER_ERROR',
     message: error instanceof Error ? error.message : 'ç”»åƒç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
   }, 500)
   ```

3. **ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼**:
   ```typescript
   console.error(`Error loading font ${family} (weight: ${weight}):`, error)
   throw new Error('ãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ')
   ```

## ä»Šå¾Œã®ã‚¿ã‚¹ã‚¯

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å„ªå…ˆé †ä½ï¼ˆæ®‹ã‚Šã‚¿ã‚¹ã‚¯ï¼‰

#### å„ªå…ˆåº¦: ä¸­
6. **HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–**ï¼ˆæœªç€æ‰‹ï¼‰
   - `/form`ã€`/templates/ui`ã€`/templates/editor`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–
   - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®å‘ä¸Š

#### å„ªå…ˆåº¦: ä½
7. **ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²**ï¼ˆæœªç€æ‰‹ï¼‰
   - `src/index.tsx`ãŒå¤§ãããªã£ã¦ã„ã‚‹ãŸã‚ã€æ©Ÿèƒ½ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²
   - æœ€ã‚‚å¤§è¦æ¨¡ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã®å‰Šé™¤ï¼‰
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤ï¼ˆbase64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åŒ–ï¼‰
3. âœ… å‹å®šç¾©ã®æ•´ç†ï¼ˆ`src/types.ts`ã¸ã®é›†ç´„ï¼‰
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã«åˆ¶é™ï¼‰
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆPOST /renderã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ï¼‰

## æ³¨æ„äº‹é …

- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æä¾›ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ
- æœ¬ç•ªç’°å¢ƒã§ã®ã‚¨ãƒ©ãƒ¼è¿½è·¡ãŒå®¹æ˜“ã«ãªã‚‹ã‚ˆã†ã€è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ã‚’è¿½åŠ ã—ãŸ
- å‹å®šç¾©ã®ä¸€è²«æ€§ãŒå‘ä¸Šã—ã€TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ãŒã‚ˆã‚ŠåŠ¹æœçš„ã«ãªã£ãŸ

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹æ™‚ã«ç¢ºèªã™ã‚‹ã“ã¨

1. ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«é€šã‚‹ã“ã¨
2. ã‚³ãƒŸãƒƒãƒˆãŒæ­£ã—ãè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆ`git log`ã§ç¢ºèªï¼‰
3. æ¬¡ã®ã‚¿ã‚¹ã‚¯ï¼ˆHTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ– or ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ï¼‰ã®å„ªå…ˆé †ä½ã‚’æ±ºå®š

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³2 - 2025å¹´11æœˆ10æ—¥ï¼ˆç¶šãï¼‰

### 4. HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–

#### ä½œæ¥­æ¦‚è¦
- **å ´æ‰€**: `src/index.tsx` â†’ `src/html-templates/`
- **ç›®çš„**: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®å‘ä¸Šã€ã‚³ãƒ¼ãƒ‰ã®æ•´ç†
- **çµæœ**: `src/index.tsx`ã‚’1,073è¡Œå‰Šæ¸›ï¼ˆç´„60%ã®å‰Šæ¸›ï¼‰

#### ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. **src/html-templates/form.ts** (203è¡Œ)
   - `/form`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨ã®HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
   - `getFormHtml()`é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - OGPç”»åƒç”Ÿæˆã®ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒ UI

2. **src/html-templates/templates-ui.ts** (230è¡Œ)
   - `/templates/ui`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨ã®HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
   - `getTemplatesUiHtml()`é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†UIï¼ˆã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼‰

3. **src/html-templates/templates-editor.ts** (651è¡Œ)
   - `/templates/editor`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨ã®HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
   - `getTemplatesEditorHtml()`é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ï¼‰

#### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

**å¤–éƒ¨åŒ–å‰**ï¼ˆ`src/index.tsx`ï¼‰:
```typescript
app.get('/form', (c) => {
  const html = `
<!DOCTYPE html>
... ~198 lines of HTML ...
</html>
  `;
  return c.html(html);
})
```

**å¤–éƒ¨åŒ–å¾Œ**ï¼ˆ`src/index.tsx`ï¼‰:
```typescript
app.get('/form', (c) => {
  const { getFormHtml } = require('./html-templates/form')
  return c.html(getFormHtml());
})
```

#### ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
- ã‚³ãƒãƒ³ãƒ‰: `wrangler deploy --dry-run --outdir=dist`
- çµæœ: **æˆåŠŸ**
- ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º: 4483.10 KiB / gzip: 1299.29 KiB

#### Gitã‚³ãƒŸãƒƒãƒˆ
- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `dac3c46`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `refactor: HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢`
- **å¤‰æ›´å†…å®¹**:
  - `src/index.tsx`: 1,090è¡Œè¿½åŠ ã€1,069è¡Œå‰Šé™¤ï¼ˆå®Ÿè³ª1,073è¡Œå‰Šæ¸›ï¼‰
  - æ–°è¦ä½œæˆ: `src/html-templates/form.ts`
  - æ–°è¦ä½œæˆ: `src/html-templates/templates-ui.ts`
  - æ–°è¦ä½œæˆ: `src/html-templates/templates-editor.ts`

### æŠ€è¡“çš„ãªè©³ç´°

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
src/
â”œâ”€â”€ index.tsx              # ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ1,073è¡Œå‰Šæ¸›å¾Œï¼‰
â”œâ”€â”€ types.ts               # å‹å®šç¾©
â””â”€â”€ html-templates/        # æ–°è¦ä½œæˆ
    â”œâ”€â”€ form.ts           # /form ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â”œâ”€â”€ templates-ui.ts   # /templates/ui ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    â””â”€â”€ templates-editor.ts # /templates/editor ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```

#### ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–¹æ³•
- CommonJSå½¢å¼ã®`require()`ã‚’ä½¿ç”¨
- å„ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã€å¿…è¦ãªç®‡æ‰€ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- ãƒ‘ã‚¿ãƒ¼ãƒ³: `const { getFunctionName } = require('./html-templates/filename')`

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ï¼ˆæ›´æ–°ï¼‰

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã®å‰Šé™¤ï¼‰
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤ï¼ˆbase64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åŒ–ï¼‰
3. âœ… å‹å®šç¾©ã®æ•´ç†ï¼ˆ`src/types.ts`ã¸ã®é›†ç´„ï¼‰
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã«åˆ¶é™ï¼‰
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆPOST /renderã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ï¼‰
6. âœ… **HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–**ï¼ˆsrc/html-templates/ã¸ã®åˆ†é›¢ï¼‰

### ä»Šå¾Œã®ã‚¿ã‚¹ã‚¯ï¼ˆæ›´æ–°ï¼‰

#### å„ªå…ˆåº¦: ä½
7. **ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²**ï¼ˆæœªç€æ‰‹ï¼‰
   - `src/index.tsx`ãŒä¾ç„¶ã¨ã—ã¦å¤§ãã„ï¼ˆå¤–éƒ¨åŒ–å¾Œã‚‚ç›¸å½“ãªè¡Œæ•°ï¼‰
   - æ©Ÿèƒ½ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹
     - ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†: `src/utils/fonts.ts`
     - ç”»åƒå¤‰æ›: `src/utils/image.ts`
     - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–¢æ•°: `src/templates/`
     - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `src/routes/`
   - æœ€ã‚‚å¤§è¦æ¨¡ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### æˆæœã¨æ”¹å–„ç‚¹

- **ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§**: HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®è¦‹é€šã—ãŒå¤§å¹…ã«æ”¹å–„
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§**: HTMLå¤‰æ›´æ™‚ã«è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’ç·¨é›†ã™ã‚Œã°è‰¯ã„
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: `src/index.tsx`ãŒ1,073è¡Œå‰Šæ¸›ã•ã‚Œã€ç®¡ç†ã—ã‚„ã™ããªã£ãŸ
- **ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º**: å¤‰æ›´å‰å¾Œã§ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºã«å¤§ããªå¤‰åŒ–ãªã—ï¼ˆæ©Ÿèƒ½ã¯åŒä¸€ã®ãŸã‚ï¼‰

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ã®å¼•ãç¶™ãäº‹é …

1. **ç¢ºèªäº‹é …**:
   - ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«é€šã‚‹ã“ã¨ï¼ˆ`wrangler deploy --dry-run --outdir=dist`ï¼‰
   - ã‚³ãƒŸãƒƒãƒˆãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆ`git log`ã§`dac3c46`ã‚’ç¢ºèªï¼‰
   - é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ï¼ˆ`npm run dev`ï¼‰

2. **æ¬¡ã®ã‚¿ã‚¹ã‚¯å€™è£œ**:
   - **ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²**ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰: ã‚ˆã‚Šç´°ã‹ã„æ©Ÿèƒ½å˜ä½ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²
   - ã¾ãŸã¯æ–°æ©Ÿèƒ½ã®è¿½åŠ ãƒ»æ”¹å–„

3. **æ³¨æ„ç‚¹**:
   - HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹éš›ã¯`src/html-templates/`é…ä¸‹ã‚’ç›´æ¥ç·¨é›†
   - `src/index.tsx`ã§ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé–¢æ•°ã‚’`require()`ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½¿ç”¨

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³3 - 2025å¹´11æœˆ10æ—¥ï¼ˆPhase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢ï¼‰

### 7. ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²: Phase 1 - ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢

#### ä½œæ¥­æ¦‚è¦
- **ç›®çš„**: `src/index.tsx`ã‚’ã•ã‚‰ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã€ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’ç‹¬ç«‹ã•ã›ã‚‹
- **çµæœ**: `src/index.tsx`ã‹ã‚‰ç´„200è¡Œå‰Šæ¸›ã€services/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«4ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆ

#### ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. **src/services/wasm.ts** (~15è¡Œ)
   - WASMåˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯
   - `ensureWasmInitialized()`: resvg-wasmã®åˆæœŸåŒ–ï¼ˆä¸€åº¦ã ã‘å®Ÿè¡Œï¼‰

2. **src/services/font.ts** (~90è¡Œ)
   - ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
   - `ensureFontsLoaded()`: Google Fontsã‹ã‚‰æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿
   - `getFonts()`: Satoriç”¨ã®ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã‚’è¿”å´
   - Noto Sans JP (400) ã¨ Noto Serif JP (700) ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥

3. **src/services/image.ts** (~50è¡Œ)
   - ç”»åƒå¤‰æ›ã‚µãƒ¼ãƒ“ã‚¹
   - `toDataUrl()`: å¤–éƒ¨URLã‚„R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç”»åƒã‚’Data URLã«å¤‰æ›
   - ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒï¼ˆ/images/*ï¼‰ã¯R2ã‹ã‚‰ç›´æ¥å–å¾—

4. **src/services/renderer.tsx** (~180è¡Œ)
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹
   - `renderTemplateToSvg()`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾©ã¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰SVGç”Ÿæˆ
   - `templateMagazineBasic()`: ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰

#### ä¿®æ­£ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

- **src/index.tsx**
  - ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®é–¢æ•°å®šç¾©ã‚’å‰Šé™¤ï¼ˆç´„200è¡Œå‰Šæ¸›ï¼‰
  - services/ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤‰æ›´
  - é‡è¤‡ã‚³ãƒ¼ãƒ‰ã‚’å®Œå…¨ã«å‰Šé™¤

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆPhase 1å®Œäº†å¾Œï¼‰

```
src/
â”œâ”€â”€ index.tsx              # ãƒ¡ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç´„200è¡Œå‰Šæ¸›ï¼‰
â”œâ”€â”€ types.ts               # å‹å®šç¾©
â”œâ”€â”€ services/              # âœ… æ–°è¦ä½œæˆï¼ˆPhase 1ï¼‰
â”‚   â”œâ”€â”€ wasm.ts           # WASMåˆæœŸåŒ–
â”‚   â”œâ”€â”€ font.ts           # ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†
â”‚   â”œâ”€â”€ image.ts          # ç”»åƒå¤‰æ›
â”‚   â””â”€â”€ renderer.tsx      # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ encoding.ts       # Base64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ api-auth.ts       # APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”œâ”€â”€ auth/                 # èªè¨¼é–¢é€£ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ api-keys/             # APIã‚­ãƒ¼ç®¡ç†ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ emails/               # ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆæ—¢å­˜ï¼‰
â””â”€â”€ html-templates/       # HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆæ—¢å­˜ï¼‰
```

#### ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã¨å‹•ä½œç¢ºèª

1. **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ**: `wrangler deploy --dry-run --outdir=dist`
   - çµæœ: âœ… æˆåŠŸ
   - ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º: 4483.31 KiB / gzip: 1299.24 KiB

2. **å‹•ä½œç¢ºèª**: `./test-local.sh`
   - âœ… PNGå½¢å¼ã§ç”»åƒç”Ÿæˆ: æˆåŠŸ
   - âœ… SVGå½¢å¼ã§ç”»åƒç”Ÿæˆ: æˆåŠŸ
   - âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: æˆåŠŸ

#### Gitã‚³ãƒŸãƒƒãƒˆ

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `f8910b2`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `refactor: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’src/services/ã«åˆ†é›¢`
- **å¤‰æ›´å†…å®¹**:
  - æ–°è¦ä½œæˆ: `src/services/wasm.ts`
  - æ–°è¦ä½œæˆ: `src/services/font.ts`
  - æ–°è¦ä½œæˆ: `src/services/image.ts`
  - æ–°è¦ä½œæˆ: `src/services/renderer.tsx`
  - ä¿®æ­£: `src/index.tsx`ï¼ˆé‡è¤‡ã‚³ãƒ¼ãƒ‰å‰Šé™¤ï¼‰

### æŠ€è¡“çš„ãªè©³ç´°

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

**Before (index.tsx)**:
```typescript
// WASMåˆæœŸåŒ–ãƒ•ãƒ©ã‚°
let wasmInitialized = false
async function ensureWasmInitialized() {
  if (!wasmInitialized) {
    await initWasm(wasmModule)
    wasmInitialized = true
  }
}

// ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥
let fontSansData: ArrayBuffer | null = null
let fontSerifData: ArrayBuffer | null = null
async function loadFont(family: string, weight: number): Promise<ArrayBuffer> {
  // ... ç´„40è¡Œã®ã‚³ãƒ¼ãƒ‰
}
async function ensureFontsLoaded() {
  // ... ç´„15è¡Œã®ã‚³ãƒ¼ãƒ‰
}
```

**After (services/wasm.ts, services/font.ts)**:
```typescript
// index.tsx
import { ensureWasmInitialized } from './services/wasm'
import { ensureFontsLoaded } from './services/font'
import { toDataUrl } from './services/image'
import { renderTemplateToSvg, templateMagazineBasic } from './services/renderer.tsx'
```

#### é‡è¦ãªæ³¨æ„ç‚¹

1. **renderer.tsxã®æ‹¡å¼µå­**
   - JSXã‚’å«ã‚€ãŸã‚`.tsx`æ‹¡å¼µå­ãŒå¿…è¦
   - `.ts`ã ã¨ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

2. **ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç®¡ç†**
   - `font.ts`å†…ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç¶­æŒ
   - `getFonts()`ã§èª­ã¿è¾¼ã¿æ¸ˆã¿ãƒ•ã‚©ãƒ³ãƒˆã‚’å–å¾—

3. **å‹å®šç¾©ã®å…±æœ‰**
   - `types.ts`ã‹ã‚‰å¿…è¦ãªå‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   - `Bindings`, `Template`, `RenderInput`ãªã©

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ï¼ˆæ›´æ–°ï¼‰

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã®å‰Šé™¤ï¼‰
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤ï¼ˆbase64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åŒ–ï¼‰
3. âœ… å‹å®šç¾©ã®æ•´ç†ï¼ˆ`src/types.ts`ã¸ã®é›†ç´„ï¼‰
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã«åˆ¶é™ï¼‰
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆPOST /renderã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ï¼‰
6. âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–ï¼ˆsrc/html-templates/ã¸ã®åˆ†é›¢ï¼‰
7. âœ… **Phase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢**ï¼ˆsrc/services/ã¸ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ï¼‰

### ä»Šå¾Œã®ã‚¿ã‚¹ã‚¯ï¼ˆPhase 2, 3ï¼‰

#### Phase 2: routes/ ã®ä½œæˆï¼ˆæœªç€æ‰‹ï¼‰

ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†å‰²:

1. **src/routes/render.ts** (~90è¡Œ)
   - `POST /render`: ç”»åƒç”ŸæˆAPI
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ‡å®šï¼ˆIDã€åå‰ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã«å¯¾å¿œ
   - PNG/SVGå½¢å¼ã®é¸æŠ

2. **src/routes/images.ts** (~90è¡Œ)
   - `POST /images/upload`: R2ã¸ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - `GET /images/*`: R2ã‹ã‚‰ç”»åƒå–å¾—
   - `DELETE /images/*`: R2ã‹ã‚‰ç”»åƒå‰Šé™¤

3. **src/routes/templates.ts** (~200è¡Œ)
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†APIï¼ˆCRUDï¼‰
   - `GET /templates`: ä¸€è¦§å–å¾—
   - `POST /templates`: æ–°è¦ä½œæˆ
   - `GET /templates/:id`: è©³ç´°å–å¾—
   - `PUT /templates/:id`: æ›´æ–°
   - `DELETE /templates/:id`: å‰Šé™¤

#### Phase 3: middleware/auth.ts ã®ä½œæˆï¼ˆæœªç€æ‰‹ï¼‰

1. **src/middleware/auth.ts** (~40è¡Œ)
   - `requireApiKey()`: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
   - ç¾åœ¨index.tsxã«ç›´æ¥è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’ç§»å‹•
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼APIã‚­ãƒ¼ã¨ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼ã®ä¸¡æ–¹ã«å¯¾å¿œ

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ã®å¼•ãç¶™ãäº‹é …

#### ç¢ºèªäº‹é …

1. **Phase 1ã®å®Œäº†ç¢ºèª**
   - âœ… ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«é€šã‚‹ã“ã¨ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰
   - âœ… test-local.shãŒæˆåŠŸã™ã‚‹ã“ã¨ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰
   - âœ… ã‚³ãƒŸãƒƒãƒˆãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆ`f8910b2`ã§ç¢ºèªæ¸ˆã¿ï¼‰

2. **Phase 2ã®æº–å‚™**
   - `src/routes/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ä½œæˆæ¸ˆã¿
   - index.tsxã‹ã‚‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹æº–å‚™å®Œäº†

#### å®Ÿè£…æ–¹é‡

**Phase 2ã®å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—**:
1. `src/routes/render.ts`ã‚’ä½œæˆï¼ˆPOST /renderã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
2. `src/routes/images.ts`ã‚’ä½œæˆï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/å–å¾—/å‰Šé™¤ï¼‰
3. `src/routes/templates.ts`ã‚’ä½œæˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†CRUDï¼‰
4. `src/index.tsx`ã‹ã‚‰è©²å½“ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã€routesã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
5. ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ + test-local.sh ã§å‹•ä½œç¢ºèª
6. ã‚³ãƒŸãƒƒãƒˆ

**Phase 3ã®å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—**:
1. `src/middleware/auth.ts`ã‚’ä½œæˆï¼ˆrequireApiKeyé–¢æ•°ï¼‰
2. `src/index.tsx`ã‹ã‚‰è©²å½“ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã€middlewareã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
3. ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ + test-local.sh ã§å‹•ä½œç¢ºèª
4. ã‚³ãƒŸãƒƒãƒˆ

#### æœŸå¾…ã•ã‚Œã‚‹æœ€çµ‚æ§‹é€ 

```
src/
â”œâ”€â”€ index.tsx (~100è¡Œ)    # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ types.ts              # å‹å®šç¾©
â”œâ”€â”€ services/             # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆPhase 1å®Œäº†ï¼‰
â”‚   â”œâ”€â”€ wasm.ts
â”‚   â”œâ”€â”€ font.ts
â”‚   â”œâ”€â”€ image.ts
â”‚   â””â”€â”€ renderer.tsx
â”œâ”€â”€ routes/               # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©ï¼ˆPhase 2ï¼‰
â”‚   â”œâ”€â”€ render.ts
â”‚   â”œâ”€â”€ images.ts
â”‚   â””â”€â”€ templates.ts
â”œâ”€â”€ middleware/           # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”œâ”€â”€ api-auth.tsï¼ˆæ—¢å­˜ï¼‰
â”‚   â””â”€â”€ auth.tsï¼ˆPhase 3ï¼‰
â”œâ”€â”€ utils/ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ auth/ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ api-keys/ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ emails/ï¼ˆæ—¢å­˜ï¼‰
â””â”€â”€ html-templates/ï¼ˆæ—¢å­˜ï¼‰
```

### æˆæœã¨æ”¹å–„ç‚¹

- **Phase 1å®Œäº†**: ã‚µãƒ¼ãƒ“ã‚¹å±¤ãŒç‹¬ç«‹ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ãªã‚Šã€å¯èª­æ€§ãŒå¤§å¹…ã«å‘ä¸Š
- **ã‚³ãƒ¼ãƒ‰å‰Šæ¸›**: `src/index.tsx`ã‹ã‚‰ç´„200è¡Œå‰Šæ¸›ï¼ˆPhase 1ã®ã¿ï¼‰
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§**: å„ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒ•ã‚©ãƒ³ãƒˆã€ç”»åƒã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ã‚’ç‹¬ç«‹ã—ã¦æ”¹å–„å¯èƒ½
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ãŒå®¹æ˜“ã«
- **æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®ä¸€è²«æ€§**: `auth/`, `api-keys/`ã¨åŒæ§˜ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³4 - 2025å¹´11æœˆ10æ—¥ï¼ˆPhase 2 & 3å®Œäº† + æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

### Phase 2: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®åˆ†é›¢ï¼ˆå®Œäº†ï¼‰

#### ä½œæ¥­æ¦‚è¦
- **ç›®çš„**: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’src/routes/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«åˆ†é›¢
- **çµæœ**: src/index.tsxã‚’680è¡Œã‹ã‚‰51è¡Œã«å‰Šæ¸›ï¼ˆ93%å‰Šæ¸›ï¼‰

#### ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. **src/routes/render.ts** (~111è¡Œ)
   - `GET /form`: ãƒ†ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒ UI
   - `POST /render`: ç”»åƒç”ŸæˆAPIï¼ˆPNG/SVGï¼‰
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ‡å®šæ–¹å¼ï¼ˆIDã€åå‰ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã«å¯¾å¿œ
   - ä¸€æ™‚çš„ã«requireApiKeyé–¢æ•°ã‚’å«ã‚€ï¼ˆPhase 3ã§å‰Šé™¤äºˆå®šï¼‰

2. **src/routes/images.ts** (~114è¡Œ)
   - `POST /images/upload`: R2ã¸ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆ10MBåˆ¶é™ï¼‰
   - `GET /images/*`: R2ã‹ã‚‰ç”»åƒå–å¾—ï¼ˆCacheãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ãï¼‰
   - `DELETE /images/*`: R2ã‹ã‚‰ç”»åƒå‰Šé™¤
   - ä¸€æ™‚çš„ã«requireApiKeyé–¢æ•°ã‚’å«ã‚€ï¼ˆPhase 3ã§å‰Šé™¤äºˆå®šï¼‰

3. **src/routes/templates.ts** (~198è¡Œ)
   - `GET /templates/ui`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†UI
   - `GET /templates/editor`: ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿
   - `GET /templates/editor/:id`: æ—¢å­˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†
   - `GET /templates`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§å–å¾—ï¼ˆAPIï¼‰
   - `GET /templates/:id`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè©³ç´°å–å¾—ï¼ˆAPIï¼‰
   - `POST /templates`: æ–°è¦ä½œæˆï¼ˆAPIï¼‰
   - `PUT /templates/:id`: æ›´æ–°ï¼ˆAPIï¼‰
   - `POST /templates/thumbnail`: ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆï¼ˆAPIï¼‰
   - `DELETE /templates/:id`: å‰Šé™¤ï¼ˆAPIï¼‰
   - ä¸€æ™‚çš„ã«requireApiKeyé–¢æ•°ã‚’å«ã‚€ï¼ˆPhase 3ã§å‰Šé™¤äºˆå®šï¼‰

#### ä¿®æ­£ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

- **src/index.tsx** (680è¡Œ â†’ 51è¡Œã«å‰Šæ¸›)
  - å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’å‰Šé™¤
  - routes/ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãƒã‚¦ãƒ³ãƒˆ
  - Hono ã® `app.route()` ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨
  ```typescript
  app.route('/', renderApp)
  app.route('/images', imagesApp)
  app.route('/templates', templatesApp)
  ```

#### ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã¨å‹•ä½œç¢ºèª

1. **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ**: `wrangler deploy --dry-run --outdir=dist`
   - âœ… æˆåŠŸ
   - ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º: 4507.88 KiB / gzip: 1299.25 KiB

2. **å‹•ä½œç¢ºèª**: `./test-local.sh`
   - âœ… PNGå½¢å¼ã§ç”»åƒç”Ÿæˆ: æˆåŠŸ
   - âœ… SVGå½¢å¼ã§ç”»åƒç”Ÿæˆ: æˆåŠŸ
   - âœ… ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯: æˆåŠŸ

#### Gitã‚³ãƒŸãƒƒãƒˆ

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `5cb06ba`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `refactor: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’src/routes/ã«åˆ†é›¢`
- **å¤‰æ›´å†…å®¹**:
  - æ–°è¦ä½œæˆ: `src/routes/render.ts`
  - æ–°è¦ä½œæˆ: `src/routes/images.ts`
  - æ–°è¦ä½œæˆ: `src/routes/templates.ts`
  - ä¿®æ­£: `src/index.tsx`ï¼ˆç´„527è¡Œè¿½åŠ ã€393è¡Œå‰Šé™¤ï¼‰

---

### Phase 3: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ±åˆï¼ˆå®Œäº†ï¼‰

#### ä½œæ¥­æ¦‚è¦
- **ç›®çš„**: é‡è¤‡ã—ãŸrequireApiKeyé–¢æ•°ã‚’çµ±åˆã—ã€DRYåŸå‰‡ã‚’å®Ÿç¾
- **çµæœ**: 3ã¤ã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é‡è¤‡ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã€middleware/api-auth.tsã«çµ±åˆ

#### ä¿®æ­£ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. **src/middleware/api-auth.ts** (æ–°è¦é–¢æ•°è¿½åŠ )
   - `requireApiKey()`: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆ43è¡Œï¼‰
   - ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆx-api-keyï¼‰ã¾ãŸã¯ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆapi_keyï¼‰ã‹ã‚‰APIã‚­ãƒ¼ã‚’å–å¾—
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®APIã‚­ãƒ¼ã‚’å„ªå…ˆçš„ã«æ¤œè¨¼
   - ç’°å¢ƒå¤‰æ•°API_KEYã‚‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ç¢ºèªï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
   - æœ€çµ‚ä½¿ç”¨æ—¥æ™‚ã®è¨˜éŒ²ï¼ˆéåŒæœŸï¼‰

2. **src/routes/render.ts** (æ›´æ–°)
   - `import { requireApiKey } from '../middleware/api-auth'` ã‚’è¿½åŠ 
   - é‡è¤‡ã—ã¦ã„ãŸrequireApiKeyé–¢æ•°ã‚’å‰Šé™¤ï¼ˆç´„40è¡Œå‰Šæ¸›ï¼‰

3. **src/routes/images.ts** (æ›´æ–°)
   - `import { requireApiKey } from '../middleware/api-auth'` ã‚’è¿½åŠ 
   - é‡è¤‡ã—ã¦ã„ãŸrequireApiKeyé–¢æ•°ã‚’å‰Šé™¤ï¼ˆç´„40è¡Œå‰Šæ¸›ï¼‰

4. **src/routes/templates.ts** (æ›´æ–°)
   - `import { requireApiKey } from '../middleware/api-auth'` ã‚’è¿½åŠ 
   - é‡è¤‡ã—ã¦ã„ãŸrequireApiKeyé–¢æ•°ã‚’å‰Šé™¤ï¼ˆç´„40è¡Œå‰Šæ¸›ï¼‰

#### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

**Before (å„routeãƒ•ã‚¡ã‚¤ãƒ«)**:
```typescript
// åŒã˜ã‚³ãƒ¼ãƒ‰ãŒ3ãƒ•ã‚¡ã‚¤ãƒ«ã«é‡è¤‡
async function requireApiKey(c: Context<{ Bindings: Bindings }>) {
  const q = c.req.query('api_key')
  const h = c.req.header('x-api-key')
  const provided = h || q
  // ... ç´„40è¡Œã®é‡è¤‡ã‚³ãƒ¼ãƒ‰
}
```

**After (middleware/api-auth.ts)**:
```typescript
// 1ç®‡æ‰€ã«çµ±åˆ
export async function requireApiKey(c: Context<{ Bindings: Bindings }>) {
  const q = c.req.query('api_key')
  const h = c.req.header('x-api-key')
  const provided = h || q

  if (!provided) {
    return c.text('Unauthorized: API key required', 401)
  }

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ºæœ‰ã®APIã‚­ãƒ¼ã‚’ãƒã‚§ãƒƒã‚¯
  try {
    const apiKeyData = await validateApiKey(c.env.TEMPLATES, provided)
    if (apiKeyData) {
      c.set('apiUserId', apiKeyData.userId)
      recordLastUsed(c.env.TEMPLATES, apiKeyData.keyId).catch(...)
      return null
    }
  } catch (error) {
    console.error('API key validation error:', error)
  }

  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ç’°å¢ƒå¤‰æ•°API_KEYï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
  if (c.env.API_KEY && provided === c.env.API_KEY) {
    return null
  }

  return c.text('Unauthorized: Invalid API key', 401)
}
```

#### ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆã¨å‹•ä½œç¢ºèª

1. **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ**: `wrangler deploy --dry-run --outdir=dist`
   - âœ… æˆåŠŸ
   - ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º: å¤‰æ›´ãªã—

2. **å‹•ä½œç¢ºèª**: `./test-local.sh`
   - âœ… ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ

#### Gitã‚³ãƒŸãƒƒãƒˆ

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `23a71a4`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `refactor: APIèªè¨¼ã‚’middleware/api-auth.tsã«çµ±åˆ`
- **å¤‰æ›´å†…å®¹**:
  - ä¿®æ­£: `src/middleware/api-auth.ts`ï¼ˆ47è¡Œè¿½åŠ ï¼‰
  - ä¿®æ­£: `src/routes/render.ts`ï¼ˆ38è¡Œå‰Šé™¤ã€1è¡Œè¿½åŠ ï¼‰
  - ä¿®æ­£: `src/routes/images.ts`ï¼ˆ38è¡Œå‰Šé™¤ã€1è¡Œè¿½åŠ ï¼‰
  - ä¿®æ­£: `src/routes/templates.ts`ï¼ˆ38è¡Œå‰Šé™¤ã€1è¡Œè¿½åŠ ï¼‰
  - åˆè¨ˆ: 47è¡Œè¿½åŠ ã€99è¡Œå‰Šé™¤

---

### æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆå®Œäº†ï¼‰

#### ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

1. **ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥**
   ```bash
   git push origin main
   ```
   - âœ… æˆåŠŸï¼ˆc5185fb..23a71a4ï¼‰

2. **Cloudflare Workersã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   npm run deploy
   ```
   - âœ… æˆåŠŸ

#### ãƒ‡ãƒ—ãƒ­ã‚¤çµæœ

- **ãƒ‡ãƒ—ãƒ­ã‚¤URL**: https://ogp-worker.tomohirof.workers.dev
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ID**: 9b366094-3045-4c93-89d9-97201ee052bb
- **Workerèµ·å‹•æ™‚é–“**: 42ms
- **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚µã‚¤ã‚º**: 4507.88 KiB / gzip: 1299.25 KiB
- **ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**:
  - KV: TEMPLATES (f2a352ab76304b9997e128ee855dd9d2)
  - R2: IMAGES (ogp-images)
  - ç’°å¢ƒå¤‰æ•°: FRONTEND_BASE_URL, PUBLIC_IMAGE_BASE_URL, ENVIRONMENT

#### æœ¬ç•ªç’°å¢ƒã§ã®å‹•ä½œç¢ºèª

1. **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**
   ```bash
   curl https://ogp-worker.tomohirof.workers.dev/
   ```
   - âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚¹: "ok"

2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†UI**
   ```bash
   curl https://ogp-worker.tomohirof.workers.dev/templates/ui
   ```
   - âœ… HTMLãŒæ­£å¸¸ã«è¿”å´ã•ã‚Œã‚‹

#### å®Œäº†ã—ãŸå…¨ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã®å‰Šé™¤ï¼‰
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤ï¼ˆbase64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åŒ–ï¼‰
3. âœ… å‹å®šç¾©ã®æ•´ç†ï¼ˆ`src/types.ts`ã¸ã®é›†ç´„ï¼‰
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã«åˆ¶é™ï¼‰
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆPOST /renderã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ï¼‰
6. âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–ï¼ˆsrc/html-templates/ã¸ã®åˆ†é›¢ï¼‰
7. âœ… **Phase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢**ï¼ˆsrc/services/ã¸ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ï¼‰
8. âœ… **Phase 2: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®åˆ†é›¢**ï¼ˆsrc/routes/ã¸ã®åˆ†é›¢ï¼‰
9. âœ… **Phase 3: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ±åˆ**ï¼ˆmiddleware/api-auth.tsï¼‰
10. âœ… **æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤**

---

### æœ€çµ‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ index.tsx              # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆ51è¡Œï¼‰93%å‰Šæ¸›
â”œâ”€â”€ types.ts               # å‹å®šç¾©
â”œâ”€â”€ services/              # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”œâ”€â”€ wasm.ts           # WASMåˆæœŸåŒ–
â”‚   â”œâ”€â”€ font.ts           # ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†
â”‚   â”œâ”€â”€ image.ts          # ç”»åƒå¤‰æ›
â”‚   â””â”€â”€ renderer.tsx      # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
â”œâ”€â”€ routes/                # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©å±¤
â”‚   â”œâ”€â”€ render.ts         # ç”»åƒç”ŸæˆAPI
â”‚   â”œâ”€â”€ images.ts         # ç”»åƒç®¡ç†API
â”‚   â””â”€â”€ templates.ts      # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†API
â”œâ”€â”€ middleware/            # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å±¤
â”‚   â””â”€â”€ api-auth.ts       # APIèªè¨¼ï¼ˆçµ±åˆæ¸ˆã¿ï¼‰
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ encoding.ts       # Base64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ auth/                  # èªè¨¼é–¢é€£ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ api-keys/              # APIã‚­ãƒ¼ç®¡ç†ï¼ˆæ—¢å­˜ï¼‰
â”œâ”€â”€ emails/                # ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆæ—¢å­˜ï¼‰
â””â”€â”€ html-templates/        # HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    â”œâ”€â”€ form.ts           # /form UI
    â”œâ”€â”€ templates-ui.ts   # /templates/ui
    â””â”€â”€ templates-editor.ts # /templates/editor
```

---

### æˆæœã¨æ”¹å–„ç‚¹

#### ã‚³ãƒ¼ãƒ‰å“è³ªã®æ”¹å–„
- **index.tsxã®ã‚µã‚¤ã‚ºå‰Šæ¸›**: 680è¡Œ â†’ 51è¡Œï¼ˆ93%å‰Šæ¸›ï¼‰
- **é‡è¤‡ã‚³ãƒ¼ãƒ‰å‰Šé™¤**: requireApiKeyé–¢æ•°ã‚’3ç®‡æ‰€ã‹ã‚‰1ç®‡æ‰€ã«çµ±åˆ
- **é–¢å¿ƒã®åˆ†é›¢**: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã€ãƒ«ãƒ¼ãƒˆå±¤ã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å±¤ã®æ˜ç¢ºãªåˆ†é›¢
- **DRYåŸå‰‡ã®å®Ÿç¾**: ã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ãŒå‘ä¸Š

#### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®å‘ä¸Š
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–**: æ©Ÿèƒ½ã”ã¨ã«ç‹¬ç«‹ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 
- **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- **å¯èª­æ€§**: å„ãƒ•ã‚¡ã‚¤ãƒ«ãŒå˜ä¸€è²¬ä»»ã‚’æŒã¤

#### æœ¬ç•ªç’°å¢ƒã§ã®å®‰å®šæ€§
- **ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ**: æœ¬ç•ªç’°å¢ƒã§æ­£å¸¸å‹•ä½œã‚’ç¢ºèª
- **èµ·å‹•æ™‚é–“**: 42msï¼ˆé«˜é€Ÿï¼‰
- **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã®APIã‚­ãƒ¼èªè¨¼ã‚’ç¶­æŒ

---

## ä»Šå¾Œã®ã‚¿ã‚¹ã‚¯

### é–‹ç™ºã‚¿ã‚¹ã‚¯ï¼ˆå„ªå…ˆåº¦é †ï¼‰

#### å„ªå…ˆåº¦: ä½
- **ã•ã‚‰ãªã‚‹æœ€é©åŒ–**ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
  - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ”¹å–„
  - ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã®è¿½åŠ 

#### ä»Šå¾Œã®æ–°æ©Ÿèƒ½é–‹ç™º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¦æœ›ã«åŸºã¥ãæ–°æ©Ÿèƒ½è¿½åŠ 
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ‹¡å¼µ
- UIã®æ”¹å–„

---

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **ç¾åœ¨ã®çŠ¶æ…‹ç¢ºèª**
   ```bash
   git log --oneline -5
   git status
   ```

2. **å‹•ä½œç¢ºèª**
   - ãƒ­ãƒ¼ã‚«ãƒ«: `npm run dev` â†’ `./test-local.sh`
   - æœ¬ç•ª: https://ogp-worker.tomohirof.workers.dev/

3. **æ¬¡ã®ã‚¿ã‚¹ã‚¯ã®æ±ºå®š**
   - æ–°æ©Ÿèƒ½ã®é–‹ç™º
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¸ã®å¯¾å¿œ
   - ã¾ãŸã¯è¿½åŠ ã®æœ€é©åŒ–

---

## æŠ€è¡“çš„ãªå­¦ã³

### Honoã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (index.tsx)
import renderApp from './routes/render'
app.route('/', renderApp)

// ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ« (routes/render.ts)
const renderApp = new Hono<{ Bindings: Bindings }>()
renderApp.post('/render', async (c) => { ... })
export default renderApp
```

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// middleware/api-auth.ts
export async function requireApiKey(c: Context<{ Bindings: Bindings }>) {
  // èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯
  if (unauthorized) return c.text('Unauthorized', 401)
  return null // èªè¨¼æˆåŠŸ
}

// routes/*.ts
const unauthorized = await requireApiKey(c)
if (unauthorized) return unauthorized
// èªè¨¼æˆåŠŸå¾Œã®å‡¦ç†
```

### ã‚µãƒ¼ãƒ“ã‚¹å±¤ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// services/renderer.tsx
export async function renderTemplateToSvg(
  template: Template,
  data: Record<string, string>,
  env: Bindings
): Promise<string> {
  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
  return svg
}

// routes/render.ts
import { renderTemplateToSvg } from '../services/renderer.tsx'
const svg = await renderTemplateToSvg(template, data, c.env)
```

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `23a71a4` (refactor: APIèªè¨¼ã‚’middleware/api-auth.tsã«çµ±åˆ)
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: `9b366094-3045-4c93-89d9-97201ee052bb`
- **ãƒ–ãƒ©ãƒ³ãƒ**: main
- **æœ¬ç•ªURL**: https://ogp-worker.tomohirof.workers.dev
- **ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æˆåŠŸ
- **ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ
- **æœ¬ç•ªå‹•ä½œç¢ºèª**: âœ… æ­£å¸¸

**ã™ã¹ã¦ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¨æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã«å–ã‚Šçµ„ã‚ã¾ã™ã€‚**

---

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **git log**ã§æœ€æ–°ã‚³ãƒŸãƒƒãƒˆï¼ˆ`23a71a4`ï¼‰ã‚’ç¢ºèª
2. æœ¬ç•ªç’°å¢ƒã®å‹•ä½œç¢ºèª
3. æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚„è¦ä»¶ã®ç¢ºèª
4. å¿…è¦ã«å¿œã˜ã¦æ–°æ©Ÿèƒ½ã®é–‹ç™ºé–‹å§‹

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³5 - 2025å¹´11æœˆ10æ—¥ï¼ˆTDDãƒ†ã‚¹ãƒˆå°å…¥ï¼‰

### 1. å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆï¼ˆå®Œäº†ï¼‰

#### ä½œæ¥­æ¦‚è¦
- **ç›®çš„**: å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€å…ƒåŒ–ã—ã€ç®¡ç†ã‚’ç°¡ç´ åŒ–
- **çµæœ**: `src/types.d.ts`ã‚’`src/types.ts`ã«çµ±åˆã—ã€å‰Šé™¤

#### å®Ÿæ–½å†…å®¹

1. **types.d.tsã®å†…å®¹ã‚’ç¢ºèª**
   - TTFãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®£è¨€ï¼ˆ5è¡Œï¼‰
   ```typescript
   declare module '*.ttf' {
     const content: ArrayBuffer
     export default content
   }
   ```

2. **types.tsã¸ã®çµ±åˆ**
   - types.d.tsã®å†…å®¹ã‚’types.tsã®å…ˆé ­ã«è¿½åŠ 
   - JSDocã‚³ãƒ¡ãƒ³ãƒˆã§æ˜ç¢ºã«åˆ†é›¢

3. **types.d.tsã®å‰Šé™¤**
   - `git rm src/types.d.ts` ã§å‰Šé™¤

4. **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ**
   - `wrangler deploy --dry-run --outdir=dist`: âœ… æˆåŠŸ
   - ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚º: 4482.96 KiB / gzip: 1298.80 KiB

#### Gitã‚³ãƒŸãƒƒãƒˆ

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `2c5795e`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `refactor: å‹å®šç¾©ã‚’types.tsã«çµ±åˆã—ã¦types.d.tsã‚’å‰Šé™¤`
- **å¤‰æ›´å†…å®¹**:
  - ä¿®æ­£: `src/types.ts`ï¼ˆTTFãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®£è¨€ã‚’è¿½åŠ ï¼‰
  - å‰Šé™¤: `src/types.d.ts`

---

### 2. Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥ï¼ˆå®Œäº†ï¼‰

#### ä½œæ¥­æ¦‚è¦
- **ç›®çš„**: TDDã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã€ã‚³ãƒ¼ãƒ‰å“è³ªã‚’å‘ä¸Š
- **æ¡ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Vitestï¼ˆCloudflare Workersç’°å¢ƒã«æœ€é©ï¼‰

#### å®Ÿæ–½å†…å®¹

1. **Vitestã¨é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm install --save-dev vitest @vitest/ui
   ```
   - è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•°: 94å€‹
   - Vitest: v4.0.8
   - @vitest/ui: v4.0.8

2. **vitest.config.tsä½œæˆ**
   ```typescript
   import { defineConfig } from 'vitest/config'

   export default defineConfig({
     test: {
       globals: true,
       environment: 'node',
       include: ['src/**/*.test.ts'],
       coverage: {
         provider: 'v8',
         reporter: ['text', 'json', 'html'],
         include: ['src/**/*.ts'],
         exclude: [
           'src/**/*.test.ts',
           'src/**/*.d.ts',
           'src/types.ts',
           'src/html-templates/**',
         ],
       },
     },
   })
   ```

3. **package.jsonã«ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ **
   ```json
   {
     "scripts": {
       "test": "vitest run",
       "test:watch": "vitest",
       "test:ui": "vitest --ui",
       "test:coverage": "vitest run --coverage"
     }
   }
   ```

#### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

**ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é¸å®šåŸºæº–**:
- ç´”ç²‹é–¢æ•°ã‹ã‚‰å„ªå…ˆçš„ã«ãƒ†ã‚¹ãƒˆ
- å¤–éƒ¨ä¾å­˜ãŒå°‘ãªã„é–¢æ•°
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€é‡è¦ãªé–¢æ•°

**ç¬¬1å€™è£œ**: `src/utils/encoding.ts`ã®`arrayBufferToDataUrl()`
- ç´”ç²‹é–¢æ•°ï¼ˆå‰¯ä½œç”¨ãªã—ï¼‰
- æ˜ç¢ºãªå…¥å‡ºåŠ›
- é‡è¦ãªæ©Ÿèƒ½ï¼ˆç”»åƒã®Data URLå¤‰æ›ï¼‰

---

### 3. arrayBufferToDataUrlé–¢æ•°ã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆTDDï¼‰

#### ä½œæ¥­æ¦‚è¦
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/utils/encoding.test.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰
- **ãƒ†ã‚¹ãƒˆå¯¾è±¡**: `arrayBufferToDataUrl()` é–¢æ•°
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 5å€‹

#### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è©³ç´°

1. **å°ã•ãªArrayBufferã®å¤‰æ›ãƒ†ã‚¹ãƒˆ**
   - å…¥åŠ›: "Hello"ã®UTF-8ãƒã‚¤ãƒˆåˆ—
   - æ¤œè¨¼: Data URLå½¢å¼ã€base64ãƒ‡ã‚³ãƒ¼ãƒ‰ã§å…ƒã®æ–‡å­—åˆ—ãŒå¾©å…ƒã§ãã‚‹ã“ã¨

2. **ç©ºã®ArrayBufferã®å¤‰æ›ãƒ†ã‚¹ãƒˆ**
   - å…¥åŠ›: 0ãƒã‚¤ãƒˆã®ãƒãƒƒãƒ•ã‚¡
   - æ¤œè¨¼: `data:image/png;base64,` ã®ã¿è¿”å´

3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆcontentTypeã®æ¤œè¨¼**
   - æ¤œè¨¼: contentTypeæœªæŒ‡å®šæ™‚ã«`image/png`ãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨

4. **ã‚«ã‚¹ã‚¿ãƒ contentTypeã®æ¤œè¨¼**
   - å…¥åŠ›: contentType = "image/jpeg"
   - æ¤œè¨¼: æŒ‡å®šã—ãŸcontentTypeãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨

5. **å¤§ããªArrayBufferï¼ˆ64KBï¼‰ã®å¤‰æ›ãƒ†ã‚¹ãƒˆ**
   - å…¥åŠ›: 64KBã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ32KBè¶…ãˆï¼‰
   - æ¤œè¨¼: ãƒãƒ£ãƒ³ã‚¯å‡¦ç†ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
   - base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®é•·ã•ãŒæœŸå¾…å€¤ï¼ˆç´„1.33å€ï¼‰ã‚’è¶…ãˆã‚‹ã“ã¨

#### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

```bash
npm test
```

**çµæœ**: âœ… å…¨5ãƒ†ã‚¹ãƒˆé€šé

```
âœ“ src/utils/encoding.test.ts (5 tests) 4ms
  âœ“ arrayBufferToDataUrl (5)
    âœ“ å°ã•ãªArrayBufferã‚’æ­£ã—ãData URLã«å¤‰æ›ã§ãã‚‹
    âœ“ ç©ºã®ArrayBufferã‚’æ­£ã—ãå¤‰æ›ã§ãã‚‹
    âœ“ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®contentTypeãŒ"image/png"ã§ã‚ã‚‹
    âœ“ ã‚«ã‚¹ã‚¿ãƒ contentTypeã‚’æŒ‡å®šã§ãã‚‹
    âœ“ å¤§ããªArrayBufferï¼ˆ32KBã‚’è¶…ãˆã‚‹ï¼‰ã‚’æ­£ã—ãå¤‰æ›ã§ãã‚‹

Test Files  1 passed (1)
Tests  5 passed (5)
Duration  252ms
```

#### Gitã‚³ãƒŸãƒƒãƒˆ

- **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥**: `44ffbaa`
- **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `test: Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨encoding.test.tsã‚’è¿½åŠ `
- **å¤‰æ›´å†…å®¹**:
  - æ–°è¦ä½œæˆ: `vitest.config.ts`
  - æ–°è¦ä½œæˆ: `src/utils/encoding.test.ts`
  - ä¿®æ­£: `package.json`ï¼ˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ï¼‰
  - ä¿®æ­£: `package-lock.json`ï¼ˆVitestä¾å­˜é–¢ä¿‚è¿½åŠ ï¼‰

---

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ï¼ˆæ›´æ–°ï¼‰

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã®å‰Šé™¤ï¼‰
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤ï¼ˆbase64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åŒ–ï¼‰
3. âœ… å‹å®šç¾©ã®æ•´ç†ï¼ˆ`src/types.ts`ã¸ã®é›†ç´„ï¼‰
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã«åˆ¶é™ï¼‰
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆPOST /renderã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ï¼‰
6. âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–ï¼ˆsrc/html-templates/ã¸ã®åˆ†é›¢ï¼‰
7. âœ… Phase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢ï¼ˆsrc/services/ã¸ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ï¼‰
8. âœ… Phase 2: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®åˆ†é›¢ï¼ˆsrc/routes/ã¸ã®åˆ†é›¢ï¼‰
9. âœ… Phase 3: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ±åˆï¼ˆmiddleware/api-auth.tsï¼‰
10. âœ… æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
11. âœ… **å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆ**ï¼ˆtypes.d.ts â†’ types.tsï¼‰
12. âœ… **Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥**ï¼ˆTDDç’°å¢ƒæ§‹ç¯‰ï¼‰
13. âœ… **arrayBufferToDataUrlé–¢æ•°ã®ãƒ†ã‚¹ãƒˆä½œæˆ**ï¼ˆ5ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€å…¨é€šéï¼‰

---

### æŠ€è¡“çš„ãªè©³ç´°

#### TDD (Test-Driven Development) ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

ä»Šå›ã¯ä»¥ä¸‹ã®TDDã‚µã‚¤ã‚¯ãƒ«ã‚’å®Ÿè·µ:

1. **Red**: ãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ãï¼ˆ`encoding.test.ts`ä½œæˆï¼‰
2. **Green**: ãƒ†ã‚¹ãƒˆã‚’é€šã™ï¼ˆæ—¢å­˜å®Ÿè£…ãŒæ—¢ã«æ­£ã—ã‹ã£ãŸãŸã‚å³åº§ã«é€šéï¼‰
3. **Refactor**: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ï¼ˆä»Šå›ã¯ã‚¹ã‚­ãƒƒãƒ—ã€æ—¢å­˜ã‚³ãƒ¼ãƒ‰ãŒååˆ†ï¼‰

#### Vitestã‚’é¸æŠã—ãŸç†ç”±

- **Cloudflare Workersäº’æ›æ€§**: Node.jsç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆã«æœ€é©
- **é«˜é€Ÿ**: Viteãƒ™ãƒ¼ã‚¹ã§é«˜é€Ÿãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **ãƒ¢ãƒ€ãƒ³ãªæ©Ÿèƒ½**: ESMã€TypeScriptã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚µãƒãƒ¼ãƒˆ
- **é–‹ç™ºè€…ä½“é¨“**: Watch modeã€UI modeã€è©³ç´°ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º

#### ä»Šå¾Œã®ãƒ†ã‚¹ãƒˆæ‹¡å¼µå€™è£œ

**å„ªå…ˆåº¦: é«˜**
- `src/services/font.ts`: ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯
- `src/services/image.ts`: ç”»åƒå¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯

**å„ªå…ˆåº¦: ä¸­**
- `src/services/renderer.tsx`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- `src/middleware/api-auth.ts`: APIèªè¨¼ãƒ­ã‚¸ãƒƒã‚¯

**å„ªå…ˆåº¦: ä½**
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆï¼ˆE2Eãƒ†ã‚¹ãƒˆï¼‰

---

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆãƒ†ã‚¹ãƒˆè¿½åŠ å¾Œï¼‰

```
src/
â”œâ”€â”€ index.tsx              # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆ51è¡Œï¼‰
â”œâ”€â”€ types.ts               # å‹å®šç¾©ï¼ˆçµ±åˆæ¸ˆã¿ï¼‰
â”œâ”€â”€ services/              # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”œâ”€â”€ wasm.ts
â”‚   â”œâ”€â”€ font.ts
â”‚   â”œâ”€â”€ image.ts
â”‚   â””â”€â”€ renderer.tsx
â”œâ”€â”€ routes/                # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©å±¤
â”‚   â”œâ”€â”€ render.ts
â”‚   â”œâ”€â”€ images.ts
â”‚   â””â”€â”€ templates.ts
â”œâ”€â”€ middleware/            # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å±¤
â”‚   â””â”€â”€ api-auth.ts
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ encoding.ts       # Base64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ encoding.test.ts  # âœ… æ–°è¦è¿½åŠ ï¼ˆ5ãƒ†ã‚¹ãƒˆï¼‰
â”œâ”€â”€ auth/
â”œâ”€â”€ api-keys/
â”œâ”€â”€ emails/
â””â”€â”€ html-templates/
    â”œâ”€â”€ form.ts
    â”œâ”€â”€ templates-ui.ts
    â””â”€â”€ templates-editor.ts

vitest.config.ts           # âœ… æ–°è¦è¿½åŠ 
```

---

### æˆæœã¨æ”¹å–„ç‚¹

#### ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: utils/encoding.ts ãŒ100%ã‚«ãƒãƒ¼
- **ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢**: ä»Šå¾Œã®å¤‰æ›´ã§ãƒã‚°ã‚’æ—©æœŸæ¤œå‡ºå¯èƒ½
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒé–¢æ•°ã®ä½¿ç”¨æ–¹æ³•ã‚’ç¤ºã™

#### é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®æ”¹å–„
- **TDDç’°å¢ƒæ§‹ç¯‰**: ä»Šå¾Œã®é–‹ç™ºã§TDDã‚’å®Ÿè·µå¯èƒ½
- **CI/CDæº–å‚™**: ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚‹ãŸã‚ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ãŒå®¹æ˜“

#### å­¦ã³
- Vitestã®è¨­å®šæ–¹æ³•
- Cloudflare Workersç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- ç´”ç²‹é–¢æ•°ã®ãƒ†ã‚¹ãƒˆä½œæˆãƒ‘ã‚¿ãƒ¼ãƒ³

---

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ã®å¼•ãç¶™ãäº‹é …

#### ç¢ºèªäº‹é …
1. **git log**ã§æœ€æ–°ã‚³ãƒŸãƒƒãƒˆï¼ˆ`44ffbaa`ï¼‰ã‚’ç¢ºèª
2. **npm test**ã§ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
3. æœ¬ç•ªç’°å¢ƒãŒæ­£å¸¸å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

#### ä»Šå¾Œã®ã‚¿ã‚¹ã‚¯å€™è£œ

**å„ªå…ˆåº¦: é«˜**
- ä»–ã®ç´”ç²‹é–¢æ•°ã¸ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 
- serviceså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ

**å„ªå…ˆåº¦: ä¸­**
- E2Eãƒ†ã‚¹ãƒˆã®å°å…¥ï¼ˆPlaywrightç­‰ï¼‰
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨ˆæ¸¬ã¨å¯è¦–åŒ–

**å„ªå…ˆåº¦: ä½**
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

---

### ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `1dafc17` (docs: ã‚»ãƒƒã‚·ãƒ§ãƒ³5ã®ä½œæ¥­å†…å®¹ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã«è¿½åŠ )
- **ãƒ–ãƒ©ãƒ³ãƒ**: main
- **ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒŸãƒƒãƒˆæ•°**: 3ã‚³ãƒŸãƒƒãƒˆ aheadï¼ˆ`2c5795e`, `44ffbaa`, `1dafc17`ï¼‰
- **ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… 5/5ãƒ†ã‚¹ãƒˆé€šé
- **ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æˆåŠŸ
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: utils/encoding.ts 100%

**TDDç’°å¢ƒã®æ§‹ç¯‰ã¨ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å°å…¥ãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯è¿½åŠ ã®ãƒ†ã‚¹ãƒˆä½œæˆã‚„æ–°æ©Ÿèƒ½é–‹ç™ºã«å–ã‚Šçµ„ã‚ã¾ã™ã€‚**

---

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³(ã‚»ãƒƒã‚·ãƒ§ãƒ³6)ã§å®Ÿæ–½ã™ã¹ãã‚¿ã‚¹ã‚¯

### æœ€å„ªå…ˆã‚¿ã‚¹ã‚¯

1. **ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥**ï¼ˆæ¨å¥¨ï¼‰
   - 3ã¤ã®ã‚³ãƒŸãƒƒãƒˆï¼ˆå‹å®šç¾©çµ±åˆã€Vitestãƒ†ã‚¹ãƒˆè¿½åŠ ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ï¼‰ã‚’push
   - `git push origin main`

### ä»Šå¾Œã®ãƒ†ã‚¹ãƒˆæ‹¡å¼µå€™è£œ

#### å„ªå…ˆåº¦: é«˜
2. **serviceså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `src/services/image.ts`: ç”»åƒå¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
     - toDataUrlé–¢æ•°ã®ãƒ†ã‚¹ãƒˆï¼ˆå¤–éƒ¨URLã€R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
     - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

3. **middlewareå±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `src/middleware/api-auth.ts`: APIèªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
     - APIã‚­ãƒ¼æ¤œè¨¼ã®ãƒ†ã‚¹ãƒˆ
     - ç’°å¢ƒå¤‰æ•°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
     - ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

#### å„ªå…ˆåº¦: ä¸­
4. **services/font.tsã®ãƒ†ã‚¹ãƒˆä½œæˆ**
   - ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

5. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®è¨ˆæ¸¬ã¨å¯è¦–åŒ–**
   - `npm run test:coverage` ã§å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèª
   - ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™: 70%ä»¥ä¸Š

#### å„ªå…ˆåº¦: ä½
6. **E2Eãƒ†ã‚¹ãƒˆã®å°å…¥æ¤œè¨**
   - Playwrightç­‰ã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
   - ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ/render, /templatesï¼‰ã®ãƒ†ã‚¹ãƒˆ

7. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–**
   - GitHub Actionsã§ãƒ†ã‚¹ãƒˆè‡ªå‹•å®Ÿè¡Œ
   - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ

### æ–°æ©Ÿèƒ½é–‹ç™ºå€™è£œ

8. **æ–°æ©Ÿèƒ½ã®é–‹ç™º**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã«å¿œã˜ã¦ï¼‰
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ‹¡å¼µ
   - UIã®æ”¹å–„
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³5ã®å®Œäº†äº‹é …ã‚µãƒãƒªãƒ¼

### âœ… å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯
1. å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆï¼ˆtypes.d.ts â†’ types.tsï¼‰
2. Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥
3. arrayBufferToDataUrlé–¢æ•°ã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ5ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€å…¨é€šéï¼‰
4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒ¼ãƒˆã®æ›´æ–°

### ğŸ“Š æˆæœæŒ‡æ¨™
- **ã‚³ãƒŸãƒƒãƒˆæ•°**: 3å€‹ï¼ˆå‹å®šç¾©ã€ãƒ†ã‚¹ãƒˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
- **æ–°è¦ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«**: 1å€‹ï¼ˆencoding.test.tsï¼‰
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 5å€‹ï¼ˆå…¨é€šéï¼‰
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: encoding.ts 100%
- **æ–°è¦ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: 94å€‹ï¼ˆVitesté–¢é€£ï¼‰

### ğŸ“ å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«
- æ–°è¦ä½œæˆ: `vitest.config.ts`
- æ–°è¦ä½œæˆ: `src/utils/encoding.test.ts`
- ä¿®æ­£: `src/types.ts`ï¼ˆTTFãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®£è¨€ã‚’è¿½åŠ ï¼‰
- å‰Šé™¤: `src/types.d.ts`
- ä¿®æ­£: `package.json`ï¼ˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ ï¼‰
- ä¿®æ­£: `package-lock.json`ï¼ˆVitestä¾å­˜é–¢ä¿‚ï¼‰
- æ›´æ–°: `SESSION_NOTES/SESSION_NOTES_20251110.md`

---

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ç¢ºèªäº‹é …

1. **GitçŠ¶æ…‹ã®ç¢ºèª**
   ```bash
   git log --oneline -5
   git status
   ```
   - æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ: `1dafc17`
   - 3ã‚³ãƒŸãƒƒãƒˆ ahead ã®çŠ¶æ…‹

2. **ãƒ†ã‚¹ãƒˆå‹•ä½œç¢ºèª**
   ```bash
   npm test
   ```
   - 5/5ãƒ†ã‚¹ãƒˆãŒé€šéã™ã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ãƒ“ãƒ«ãƒ‰ç¢ºèª**
   ```bash
   wrangler deploy --dry-run --outdir=dist
   ```
   - ãƒ“ãƒ«ãƒ‰ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

4. **æœ¬ç•ªç’°å¢ƒç¢ºèª**
   - https://ogp-worker.tomohirof.workers.dev/ ãŒæ­£å¸¸å‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

5. **ãƒªãƒ¢ãƒ¼ãƒˆãƒ—ãƒƒã‚·ãƒ¥ã®æ¤œè¨**
   - 3ã¤ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒŸãƒƒãƒˆã‚’ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã‹åˆ¤æ–­

---

## é‡è¦ãªæŠ€è¡“çš„ãƒãƒ¼ãƒˆ

### TDDå®Ÿè·µã®ãƒã‚¤ãƒ³ãƒˆ
- **ç´”ç²‹é–¢æ•°ã‹ã‚‰å„ªå…ˆ**: å¤–éƒ¨ä¾å­˜ãŒãªã„é–¢æ•°ãŒæœ€ã‚‚ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„
- **Red-Green-Refactor**: ãƒ†ã‚¹ãƒˆ â†’ å®Ÿè£… â†’ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ã®ã‚µã‚¤ã‚¯ãƒ«
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: 100%ã‚’ç›®æŒ‡ã™ã®ã§ã¯ãªãã€é‡è¦ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒãƒ¼

### Vitestã®ä¾¿åˆ©ãªã‚³ãƒãƒ³ãƒ‰
```bash
npm test              # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:watch    # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•å†å®Ÿè¡Œï¼‰
npm run test:ui       # UIãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆçµæœç¢ºèªï¼‰
npm run test:coverage # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
```

### ä»Šå¾Œã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
1. ç´”ç²‹é–¢æ•° â†’ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ â†’ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ â†’ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®é †ã§ãƒ†ã‚¹ãƒˆè¿½åŠ 
2. ãƒ¢ãƒƒã‚¯/ã‚¹ã‚¿ãƒ–ã¯æœ€å°é™ã«ï¼ˆæœ¬ç‰©ã®å‹•ä½œã‚’å„ªå…ˆï¼‰
3. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã‚‚å¿…ãšã‚«ãƒãƒ¼

---

**ã‚»ãƒƒã‚·ãƒ§ãƒ³5å®Œäº†ã€‚æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯ãƒ†ã‚¹ãƒˆæ‹¡å¼µã¾ãŸã¯æ–°æ©Ÿèƒ½é–‹ç™ºã«å–ã‚Šçµ„ã‚€æº–å‚™ãŒæ•´ã£ã¦ã„ã¾ã™ã€‚**

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³6 - 2025å¹´11æœˆ10æ—¥ï¼ˆTDDãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå°å…¥å®Œäº†ï¼‰

### å®Ÿæ–½æ¦‚è¦

TDDã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã€serviceså±¤ã¨middlewareå±¤ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’100%é”æˆã—ã¾ã—ãŸã€‚

### å®Ÿæ–½å†…å®¹

#### 1. services/image.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå®Œäº†ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/image.test.ts`ï¼ˆæ–°è¦ä½œæˆã€442è¡Œï¼‰
**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 13å€‹ï¼ˆå…¨ã¦é€šé âœ…ï¼‰

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- **å¤–éƒ¨URLã®ç”»åƒå–å¾—**ï¼ˆ4ãƒ†ã‚¹ãƒˆï¼‰
  - æ­£å¸¸ã‚±ãƒ¼ã‚¹ï¼ˆPNGå–å¾—ï¼‰
  - å¤±æ•—ã‚±ãƒ¼ã‚¹ï¼ˆ404ã‚¨ãƒ©ãƒ¼ï¼‰
  - content-typeãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆimage/pngï¼‰
  - JPEGå¯¾å¿œï¼ˆimage/jpegï¼‰

- **R2ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã®ç”»åƒå–å¾—**ï¼ˆ7ãƒ†ã‚¹ãƒˆï¼‰
  - R2ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ä½¿ç”¨ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«URLï¼‰
  - æœ¬ç•ªç’°å¢ƒURLå¯¾å¿œ
  - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸å­˜åœ¨ã‚¨ãƒ©ãƒ¼
  - contentTypeãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  - envæœªå®šç¾©æ™‚ã®å¤–éƒ¨URLæ‰±ã„
  - env.IMAGESãªã—æ™‚ã®å¤–éƒ¨URLæ‰±ã„

- **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹**ï¼ˆ4ãƒ†ã‚¹ãƒˆï¼‰
  - ç©ºç”»åƒãƒ‡ãƒ¼ã‚¿
  - å¤§ããªç”»åƒï¼ˆ1MBï¼‰
  - URLã«ç‰¹æ®Šæ–‡å­—

**ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**:
- `vi.fn()`ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«fetchã‚’ãƒ¢ãƒƒã‚¯
- R2ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ‰‹å‹•ã§ãƒ¢ãƒƒã‚¯
- `arrayBufferToDataUrl()`ã¯å®Ÿéš›ã®å®Ÿè£…ã‚’ä½¿ç”¨

**ã‚«ãƒãƒ¬ãƒƒã‚¸**: `services/image.ts` **100%**

#### 2. middleware/api-auth.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå®Œäº†ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/middleware/api-auth.test.ts`ï¼ˆæ–°è¦ä½œæˆã€422è¡Œï¼‰
**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 16å€‹ï¼ˆå…¨ã¦é€šé âœ…ï¼‰

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- **requireApiKeyé–¢æ•°**ï¼ˆ12ãƒ†ã‚¹ãƒˆï¼‰
  - APIã‚­ãƒ¼ãªã—ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸¡æ–¹ãªã—ï¼‰
  - æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼APIã‚­ãƒ¼ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰
  - æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼APIã‚­ãƒ¼ï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
  - ãƒ˜ãƒƒãƒ€ãƒ¼å„ªå…ˆï¼ˆä¸¡æ–¹ã‚ã‚‹å ´åˆï¼‰
  - ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼ã¸ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼ä¸€è‡´ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
  - ç’°å¢ƒå¤‰æ•°APIã‚­ãƒ¼ä¸ä¸€è‡´
  - ç’°å¢ƒå¤‰æ•°æœªè¨­å®š
  - validateApiKeyã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - recordLastUsedã‚¨ãƒ©ãƒ¼æ™‚ã‚‚èªè¨¼æˆåŠŸ

- **requireApiKeyAuthé–¢æ•°**ï¼ˆ4ãƒ†ã‚¹ãƒˆï¼‰
  - APIã‚­ãƒ¼ãªã—ï¼ˆ401 JSONï¼‰
  - ç„¡åŠ¹ãªAPIã‚­ãƒ¼ï¼ˆ401 JSONï¼‰
  - æœ‰åŠ¹ãªAPIã‚­ãƒ¼ï¼ˆnext()å‘¼ã³å‡ºã—ã€userIdã‚»ãƒƒãƒˆï¼‰
  - recordLastUsedã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å‡¦ç†ç¶™ç¶š

- **getApiUserIdé–¢æ•°**ï¼ˆ2ãƒ†ã‚¹ãƒˆï¼‰
  - userIdã‚ã‚Š
  - userIdãªã—ï¼ˆundefinedï¼‰

**ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**:
- `createMockContext()`é–¢æ•°ã§Honoã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ‰‹å‹•ãƒ¢ãƒƒã‚¯
- `vi.mock()`ã§`validateApiKey`ã¨`recordLastUsed`ã‚’ãƒ¢ãƒƒã‚¯
- `console.error`ã‚‚ã‚¹ãƒ‘ã‚¤ã§ãƒ¢ãƒƒã‚¯

**ã‚«ãƒãƒ¬ãƒƒã‚¸**: `middleware/api-auth.ts` **100%**

#### 3. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šï¼ˆå®Œäº†ï¼‰

**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ **:
- `@vitest/coverage-v8`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆ110ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ ï¼‰

**ã‚«ãƒãƒ¬ãƒƒã‚¸çµæœ**:
```
ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«: 100%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ
- middleware/api-auth.ts: 100%
- services/image.ts: 100%
- utils/encoding.ts: 100%ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³5ã§ä½œæˆï¼‰

å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸: 7.57%
ï¼ˆæœªãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚€å…¨ä½“ï¼‰
```

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:
```bash
npm run test:coverage
```

#### 4. ãƒªãƒã‚¸ãƒˆãƒªãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆå®Œäº†ï¼‰

- `coverage/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`.gitignore`ã«è¿½åŠ 
- èª¤ã£ã¦ã‚³ãƒŸãƒƒãƒˆã—ãŸã‚«ãƒãƒ¬ãƒƒã‚¸HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
- ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥

### Gitã‚³ãƒŸãƒƒãƒˆå±¥æ­´

1. **ã‚³ãƒŸãƒƒãƒˆ**: `6733885`
   - **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `test: services/image.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆ13ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰`
   - **å†…å®¹**: image.test.tsä½œæˆã€13ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…

2. **ã‚³ãƒŸãƒƒãƒˆ**: `681afd2`
   - **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `test: middleware/api-auth.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ï¼ˆ16ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰`
   - **å†…å®¹**: api-auth.test.tsä½œæˆã€16ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè£…

3. **ã‚³ãƒŸãƒƒãƒˆ**: `2f5da90`
   - **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `chore: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«(@vitest/coverage-v8)ã‚’è¿½åŠ `
   - **å†…å®¹**: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€package.jsonæ›´æ–°

4. **ã‚³ãƒŸãƒƒãƒˆ**: `a01477e`
   - **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: `chore: coverage/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’.gitignoreã«è¿½åŠ `
   - **å†…å®¹**: .gitignoreæ›´æ–°ã€coverageãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤

**ãƒ—ãƒƒã‚·ãƒ¥**: `git push origin main`ï¼ˆæˆåŠŸ âœ…ï¼‰

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

```bash
npm test
```

**çµæœ**:
- Test Files: **3 passed**
- Tests: **34 passed**
  - encoding.test.ts: 5ãƒ†ã‚¹ãƒˆ
  - image.test.ts: 13ãƒ†ã‚¹ãƒˆ
  - api-auth.test.ts: 16ãƒ†ã‚¹ãƒˆ
- Duration: 147ms

### æŠ€è¡“çš„ãªå­¦ã³

#### TDDã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«**:
1. **Red**: ãƒ†ã‚¹ãƒˆã‚’å…ˆã«æ›¸ã
2. **Green**: ãƒ†ã‚¹ãƒˆã‚’é€šã™ï¼ˆæ—¢å­˜å®Ÿè£…ãŒæ­£ã—ã‹ã£ãŸãŸã‚å³åº§ã«é€šéï¼‰
3. **Refactor**: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ï¼ˆä»Šå›ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰

#### ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

**1. fetchã®ãƒ¢ãƒƒã‚¯**:
```typescript
global.fetch = vi.fn().mockResolvedValue({
  ok: true,
  arrayBuffer: async () => mockData.buffer,
  headers: { get: () => 'image/png' }
})
```

**2. R2ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ãƒ¢ãƒƒã‚¯**:
```typescript
const mockEnv: Partial<Bindings> = {
  IMAGES: {
    get: vi.fn().mockResolvedValue(mockR2Object)
  } as any
}
```

**3. Honoã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¢ãƒƒã‚¯**:
```typescript
function createMockContext(options: {
  header?: Record<string, string>
  query?: Record<string, string>
  env?: Partial<Bindings>
}): Context<{ Bindings: Bindings }> {
  const contextStore = new Map<string, any>()
  
  return {
    req: {
      header: (name) => options.header?.[name] || null,
      query: (name) => options.query?.[name] || undefined
    },
    env: options.env as Bindings,
    set: (key, value) => contextStore.set(key, value),
    get: (key) => contextStore.get(key),
    text: (body, status) => ({ body, status, type: 'text' }),
    json: (data, status) => ({ data, status, type: 'json' })
  } as any
}
```

#### Vitestã®ä¾¿åˆ©ãªã‚³ãƒãƒ³ãƒ‰

```bash
npm test                # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:watch      # ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•å†å®Ÿè¡Œï¼‰
npm run test:ui         # UIãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªï¼‰
npm run test:coverage   # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³6å®Œäº†å¾Œï¼‰

```
src/
â”œâ”€â”€ index.tsx
â”œâ”€â”€ types.ts
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ wasm.ts
â”‚   â”œâ”€â”€ font.ts
â”‚   â”œâ”€â”€ image.ts
â”‚   â”œâ”€â”€ image.test.ts          âœ… æ–°è¦ï¼ˆ13ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â””â”€â”€ renderer.tsx
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ api-auth.ts
â”‚   â””â”€â”€ api-auth.test.ts       âœ… æ–°è¦ï¼ˆ16ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ render.ts
â”‚   â”œâ”€â”€ images.ts
â”‚   â””â”€â”€ templates.ts
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ encoding.ts
â”‚   â””â”€â”€ encoding.test.ts       âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³5ï¼ˆ5ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”œâ”€â”€ auth/
â”œâ”€â”€ api-keys/
â”œâ”€â”€ emails/
â””â”€â”€ html-templates/

vitest.config.ts                âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³5ã§ä½œæˆ
.gitignore                      âœ… coverage/è¿½åŠ 
```

### æˆæœã¨æ”¹å–„ç‚¹

#### ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: ãƒ†ã‚¹ãƒˆæ¸ˆã¿3ãƒ•ã‚¡ã‚¤ãƒ«å…¨ã¦100%é”æˆ
- **ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢**: ä»Šå¾Œã®å¤‰æ›´ã§ãƒã‚°ã‚’æ—©æœŸç™ºè¦‹å¯èƒ½
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒé–¢æ•°ã®ä½¿ç”¨æ–¹æ³•ã‚’ç¤ºã™

#### é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®æ”¹å–„
- **TDDç’°å¢ƒç¢ºç«‹**: ä»Šå¾Œã®é–‹ç™ºã§TDDã‚’å®Ÿè·µå¯èƒ½
- **CI/CDæº–å‚™**: ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚‹ãŸã‚ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹ç¯‰ãŒå®¹æ˜“

#### å­¦ã³
- Vitestã®è¨­å®šã¨ãƒ¢ãƒƒã‚¯æˆ¦ç•¥
- Cloudflare Workersç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
- ç´”ç²‹é–¢æ•°ã¨ä¾å­˜é–¢æ•°ã®ãƒ†ã‚¹ãƒˆä½œæˆãƒ‘ã‚¿ãƒ¼ãƒ³
- Honoã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¢ãƒƒã‚¯æ–¹æ³•

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ï¼ˆå…¨ä½“ã‚µãƒãƒªãƒ¼ï¼‰

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸAPIã‚­ãƒ¼ã®å‰Šé™¤ï¼‰
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤ï¼ˆbase64å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£åŒ–ï¼‰
3. âœ… å‹å®šç¾©ã®æ•´ç†ï¼ˆ`src/types.ts`ã¸ã®é›†ç´„ï¼‰
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã¿ã«åˆ¶é™ï¼‰
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆPOST /renderã€ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ï¼‰
6. âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–ï¼ˆsrc/html-templates/ã¸ã®åˆ†é›¢ï¼‰
7. âœ… Phase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢ï¼ˆsrc/services/ã¸ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ï¼‰
8. âœ… Phase 2: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®åˆ†é›¢ï¼ˆsrc/routes/ã¸ã®åˆ†é›¢ï¼‰
9. âœ… Phase 3: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ±åˆï¼ˆmiddleware/api-auth.tsï¼‰
10. âœ… æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
11. âœ… å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆï¼ˆtypes.d.ts â†’ types.tsï¼‰
12. âœ… Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥ï¼ˆTDDç’°å¢ƒæ§‹ç¯‰ï¼‰
13. âœ… arrayBufferToDataUrlé–¢æ•°ã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ5ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰
14. âœ… **services/image.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ13ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰**
15. âœ… **middleware/api-auth.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ16ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰**
16. âœ… **ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ã®å°å…¥ï¼ˆ@vitest/coverage-v8ï¼‰**
17. âœ… **ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥**

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³7ï¼‰ã§å®Ÿæ–½ã™ã¹ãã‚¿ã‚¹ã‚¯

#### å„ªå…ˆåº¦: é«˜

1. **services/font.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `ensureFontsLoaded()`é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
   - ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - Google Fonts fetchã®ãƒ¢ãƒƒã‚¯
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

2. **services/wasm.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `ensureWasmInitialized()`é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
   - åˆå›åˆæœŸåŒ–ã®ãƒ†ã‚¹ãƒˆ
   - 2å›ç›®ä»¥é™ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‹•ä½œãƒ†ã‚¹ãƒˆ

#### å„ªå…ˆåº¦: ä¸­

3. **services/renderer.tsxã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `renderTemplateToSvg()`é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
   - Satoriã®ãƒ¢ãƒƒã‚¯æˆ¦ç•¥
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

4. **routeså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `routes/render.ts`: POST /renderã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
   - `routes/images.ts`: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/å–å¾—/å‰Šé™¤ã®ãƒ†ã‚¹ãƒˆ
   - `routes/templates.ts`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†CRUDã®ãƒ†ã‚¹ãƒˆ

5. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™é”æˆ**
   - å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸: 50%ä»¥ä¸Šã‚’ç›®æŒ‡ã™
   - é‡è¦ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯80%ä»¥ä¸Š

#### å„ªå…ˆåº¦: ä½

6. **E2Eãƒ†ã‚¹ãƒˆã®å°å…¥æ¤œè¨**
   - Playwrightã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
   - ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ/render, /templatesï¼‰ã®ãƒ†ã‚¹ãƒˆ
   - ç”»åƒç”Ÿæˆãƒ•ãƒ­ãƒ¼ã®çµ±åˆãƒ†ã‚¹ãƒˆ

7. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–**
   - GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ
   - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   - ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆ

8. **æ–°æ©Ÿèƒ½ã®é–‹ç™º**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã«å¿œã˜ã¦ï¼‰
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ‹¡å¼µ
   - UIã®æ”¹å–„
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `a01477e` (chore: coverage/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’.gitignoreã«è¿½åŠ )
- **ãƒ–ãƒ©ãƒ³ãƒ**: main
- **ãƒªãƒ¢ãƒ¼ãƒˆã¨ã®åŒæœŸ**: âœ… åŒæœŸæ¸ˆã¿ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å®Œäº†ï¼‰
- **ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… 34/34ãƒ†ã‚¹ãƒˆé€šé
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«100%
- **ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æˆåŠŸ
- **æœ¬ç•ªç’°å¢ƒ**: https://ogp-worker.tomohirof.workers.devï¼ˆæ­£å¸¸å‹•ä½œä¸­ï¼‰

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ç¢ºèªäº‹é …

1. **GitçŠ¶æ…‹ã®ç¢ºèª**
   ```bash
   git log --oneline -5
   git status
   ```
   - æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ: `a01477e`
   - ãƒªãƒ¢ãƒ¼ãƒˆã¨åŒæœŸæ¸ˆã¿

2. **ãƒ†ã‚¹ãƒˆå‹•ä½œç¢ºèª**
   ```bash
   npm test
   ```
   - 34/34ãƒ†ã‚¹ãƒˆãŒé€šéã™ã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª**
   ```bash
   npm run test:coverage
   ```
   - ãƒ†ã‚¹ãƒˆæ¸ˆã¿3ãƒ•ã‚¡ã‚¤ãƒ«100%ã‚’ç¢ºèª

4. **æ¬¡ã®ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®æ±ºå®š**
   - `services/font.ts`ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’æ¨å¥¨
   - ã¾ãŸã¯`services/wasm.ts`ï¼ˆã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ï¼‰

---

**ã‚»ãƒƒã‚·ãƒ§ãƒ³6å®Œäº†ã€‚TDDã«ã‚ˆã‚‹ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå°å…¥ãŒæˆåŠŸã—ã€ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦100%ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é”æˆã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯è¿½åŠ ã®ãƒ†ã‚¹ãƒˆä½œæˆã«å–ã‚Šçµ„ã‚€æº–å‚™ãŒæ•´ã£ã¦ã„ã¾ã™ã€‚**

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³7 - 2025å¹´11æœˆ10æ—¥ï¼ˆserviceså±¤ã®æ®‹ã‚Šãƒ†ã‚¹ãƒˆå®Œäº†ï¼‰

### å®Ÿæ–½æ¦‚è¦

TDDã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§services/wasm.tsã¨services/font.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã€serviceså±¤ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸100%ã‚’é”æˆã—ã¾ã—ãŸã€‚

### å®Ÿæ–½å†…å®¹

#### 1. services/wasm.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå®Œäº†âœ…ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/wasm.test.ts`ï¼ˆæ–°è¦ä½œæˆã€110è¡Œï¼‰
**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 5å€‹ï¼ˆå…¨ã¦é€šé âœ…ï¼‰

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- åˆå›å‘¼ã³å‡ºã—ã§WASMåˆæœŸåŒ–
- 2å›ç›®ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ï¼ˆinitWasmãŒå†å‘¼ã³å‡ºã•ã‚Œãªã„ï¼‰
- initWasmã«æ­£ã—ã„wasmModuleã‚’æ¸¡ã™
- initWasmãŒã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ãŸå ´åˆã®ä¼æ’­
- ã‚¨ãƒ©ãƒ¼å¾Œã®å†å‘¼ã³å‡ºã—ã§å†åº¦åˆæœŸåŒ–ã‚’è©¦ã¿ã‚‹

**ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**:
- `vi.mock()`ã§`@resvg/resvg-wasm`ã¨`wasmModule`ã‚’ãƒ¢ãƒƒã‚¯
- `vi.resetModules()`ã§ãƒ†ã‚¹ãƒˆé–“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

**ã‚«ãƒãƒ¬ãƒƒã‚¸**: `services/wasm.ts` **100%**

#### 2. services/font.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå®Œäº†âœ…ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/font.test.ts`ï¼ˆæ–°è¦ä½œæˆã€238è¡Œï¼‰
**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 8å€‹ï¼ˆå…¨ã¦é€šé âœ…ï¼‰

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- **ensureFontsLoadedé–¢æ•°**ï¼ˆ5ãƒ†ã‚¹ãƒˆï¼‰
  - åˆå›å‘¼ã³å‡ºã—ã§Noto Sans JPã¨Noto Serif JPã‚’èª­ã¿è¾¼ã‚€
  - 2å›ç›®ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ï¼ˆå†åº¦fetchã—ãªã„ï¼‰
  - CSSå–å¾—å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼
  - ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å–å¾—å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼
  - CSSè§£æå¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼

- **getFontsé–¢æ•°**ï¼ˆ3ãƒ†ã‚¹ãƒˆï¼‰
  - ãƒ•ã‚©ãƒ³ãƒˆæœªèª­ã¿è¾¼ã¿æ™‚ã®ã‚¨ãƒ©ãƒ¼
  - ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å¾Œã®æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿è¿”å´
  - å‚ç…§ã®ä¸€è²«æ€§ï¼ˆè¤‡æ•°å›å‘¼ã³å‡ºã—ã¦ã‚‚åŒã˜å‚ç…§ã‚’è¿”ã™ï¼‰

**ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**:
- `global.fetch`ã‚’`vi.fn()`ã§ãƒ¢ãƒƒã‚¯
- `beforeEach`ã§`__resetFontsForTesting()`ã‚’å‘¼ã³å‡ºã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒªã‚»ãƒƒãƒˆ
- CSS APIã¨ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®fetchã‚’ãƒ¢ãƒƒã‚¯

**è¿½åŠ å¤‰æ›´**: `font.ts`ã«`__resetFontsForTesting()`é–¢æ•°ã‚’è¿½åŠ ï¼ˆãƒ†ã‚¹ãƒˆå°‚ç”¨ï¼‰

**ã‚«ãƒãƒ¬ãƒƒã‚¸**: `services/font.ts` **100%**

#### 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

```bash
npm test
```

**çµæœ**:
- Test Files: **5 passed (5)**
- Tests: **47 passed (47)**
  - encoding.test.ts: 5ãƒ†ã‚¹ãƒˆ
  - font.test.ts: 8ãƒ†ã‚¹ãƒˆï¼ˆæ–°è¦ï¼‰
  - wasm.test.ts: 5ãƒ†ã‚¹ãƒˆï¼ˆæ–°è¦ï¼‰
  - api-auth.test.ts: 16ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
  - image.test.ts: 13ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
- Duration: 195ms

#### 4. Gitã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆå®Œäº†âœ…ï¼‰

**ã‚³ãƒŸãƒƒãƒˆ**: `4a35e10`
```
test: services/wasm.tsã¨services/font.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ 

- services/wasm.test.ts: 5ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
  - åˆå›å‘¼ã³å‡ºã—ã§WASMåˆæœŸåŒ–
  - 2å›ç›®ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- services/font.test.ts: 8ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
  - Google Fonts APIã‹ã‚‰ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‹•ä½œã®ç¢ºèª
  - ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
  - getFontsé–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

- font.tsã«__resetFontsForTesting()é–¢æ•°ã‚’è¿½åŠ ï¼ˆãƒ†ã‚¹ãƒˆå°‚ç”¨ï¼‰

å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: 47å€‹ï¼ˆå…¨ã¦é€šéï¼‰
```

**ãƒ—ãƒƒã‚·ãƒ¥**: `git push origin main`ï¼ˆæˆåŠŸ âœ…ï¼‰

### æŠ€è¡“çš„ãªå­¦ã³

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—å¤‰æ•°ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã®å¤‰æ•°ï¼ˆ`fontSansData`ã€`fontSerifData`ã€`wasmInitialized`ï¼‰ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹éš›ã®èª²é¡Œã¨è§£æ±ºç­–:

**å•é¡Œ**: ãƒ†ã‚¹ãƒˆé–“ã§çŠ¶æ…‹ãŒå…±æœ‰ã•ã‚Œã‚‹

**è§£æ±ºç­–**:
1. ãƒ†ã‚¹ãƒˆç”¨ã®ãƒªã‚»ãƒƒãƒˆé–¢æ•°`__resetFontsForTesting()`ã‚’è¿½åŠ 
2. `beforeEach`ã§æ¯å›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãƒªã‚»ãƒƒãƒˆ
3. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨

**ãƒ¡ãƒªãƒƒãƒˆ**: å„ãƒ†ã‚¹ãƒˆãŒç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½ã«ãªã‚Šã€ãƒ†ã‚¹ãƒˆã®ä¿¡é ¼æ€§ãŒå‘ä¸Š

#### Vitestã®vi.mock()ã¨vi.resetModules()

```typescript
// ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¨ä½“ã‚’ãƒ¢ãƒƒã‚¯
vi.mock('@resvg/resvg-wasm', () => ({
  initWasm: vi.fn().mockResolvedValue(undefined)
}))

// beforeEachã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
beforeEach(async () => {
  vi.resetModules()
  const { initWasm } = await import('@resvg/resvg-wasm')
  vi.mocked(initWasm).mockClear()
})
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³7å®Œäº†å¾Œï¼‰

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ wasm.ts
â”‚   â”œâ”€â”€ wasm.test.ts          âœ… æ–°è¦ï¼ˆ5ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â”œâ”€â”€ font.ts               âœ… æ›´æ–°ï¼ˆ__resetFontsForTestingè¿½åŠ ï¼‰
â”‚   â”œâ”€â”€ font.test.ts          âœ… æ–°è¦ï¼ˆ8ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â”œâ”€â”€ image.ts
â”‚   â”œâ”€â”€ image.test.ts         âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³6ï¼ˆ13ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â””â”€â”€ renderer.tsx
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ api-auth.ts
â”‚   â””â”€â”€ api-auth.test.ts      âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³6ï¼ˆ16ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ encoding.ts
â”‚   â””â”€â”€ encoding.test.ts      âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³5ï¼ˆ5ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â””â”€â”€ ...ï¼ˆãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
```

### æˆæœã¨æ”¹å–„ç‚¹

#### ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š
- **serviceså±¤ãƒ†ã‚¹ãƒˆå®Œäº†**: wasm.tsã€font.tsã€image.tsã®å…¨ã¦ãŒ100%ã‚«ãƒãƒ¬ãƒƒã‚¸
- **ãƒ†ã‚¹ãƒˆç·æ•°**: 47ãƒ†ã‚¹ãƒˆï¼ˆå…¨é€šéï¼‰
- **ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢**: ä»Šå¾Œã®å¤‰æ›´ã§ãƒã‚°ã‚’æ—©æœŸç™ºè¦‹å¯èƒ½

#### é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®æ”¹å–„
- **TDDå®Ÿè·µ**: Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«ã®å®Ÿè·µ
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—å¤‰æ•°ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**: å†åˆ©ç”¨å¯èƒ½ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºç«‹

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ï¼ˆå…¨ä½“ã‚µãƒãƒªãƒ¼ï¼‰

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤
3. âœ… å‹å®šç¾©ã®æ•´ç†
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„
6. âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–
7. âœ… Phase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢
8. âœ… Phase 2: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®åˆ†é›¢
9. âœ… Phase 3: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ±åˆ
10. âœ… æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
11. âœ… å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆ
12. âœ… Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥
13. âœ… utils/encoding.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ5ãƒ†ã‚¹ãƒˆï¼‰
14. âœ… services/image.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ13ãƒ†ã‚¹ãƒˆï¼‰
15. âœ… middleware/api-auth.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ16ãƒ†ã‚¹ãƒˆï¼‰
16. âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ã®å°å…¥
17. âœ… **services/wasm.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ5ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰**
18. âœ… **services/font.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ8ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰**

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³8ï¼‰ã§å®Ÿæ–½ã™ã¹ãã‚¿ã‚¹ã‚¯

#### å„ªå…ˆåº¦: ä¸­

1. **services/renderer.tsxã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `renderTemplateToSvg()`é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
   - Satoriã®ãƒ¢ãƒƒã‚¯æˆ¦ç•¥
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ
   - JSXãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

2. **routeså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `routes/render.ts`: POST /renderã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
   - `routes/images.ts`: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/å–å¾—/å‰Šé™¤ã®ãƒ†ã‚¹ãƒˆ
   - `routes/templates.ts`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†CRUDã®ãƒ†ã‚¹ãƒˆ

3. **authå±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - èªè¨¼é–¢é€£ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

4. **api-keyså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - APIã‚­ãƒ¼ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - CRUDæ“ä½œã®ãƒ†ã‚¹ãƒˆ

#### å„ªå…ˆåº¦: ä½

5. **E2Eãƒ†ã‚¹ãƒˆã®å°å…¥æ¤œè¨**
   - Playwrightã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
   - ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ/render, /templatesï¼‰ã®ãƒ†ã‚¹ãƒˆ

6. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–**
   - GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ
   - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

7. **æ–°æ©Ÿèƒ½ã®é–‹ç™º**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã«å¿œã˜ã¦ï¼‰
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ‹¡å¼µ
   - UIã®æ”¹å–„

### ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `4a35e10` (test: services/wasm.tsã¨services/font.tsã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ )
- **ãƒ–ãƒ©ãƒ³ãƒ**: main
- **ãƒªãƒ¢ãƒ¼ãƒˆã¨ã®åŒæœŸ**: âœ… åŒæœŸæ¸ˆã¿ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å®Œäº†ï¼‰
- **ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… 47/47ãƒ†ã‚¹ãƒˆé€šé
- **ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**: encoding.ts, wasm.ts, font.ts, image.ts, api-auth.tsï¼ˆå…¨ã¦100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- **ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æˆåŠŸ
- **æœ¬ç•ªç’°å¢ƒ**: https://ogp-worker.tomohirof.workers.devï¼ˆæ­£å¸¸å‹•ä½œä¸­ï¼‰

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ç¢ºèªäº‹é …

1. **GitçŠ¶æ…‹ã®ç¢ºèª**
   ```bash
   git log --oneline -5
   git status
   ```
   - æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ: `4a35e10`
   - ãƒªãƒ¢ãƒ¼ãƒˆã¨åŒæœŸæ¸ˆã¿

2. **ãƒ†ã‚¹ãƒˆå‹•ä½œç¢ºèª**
   ```bash
   npm test
   ```
   - 47/47ãƒ†ã‚¹ãƒˆãŒé€šéã™ã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª**
   ```bash
   npm run test:coverage
   ```
   - ãƒ†ã‚¹ãƒˆæ¸ˆã¿5ãƒ•ã‚¡ã‚¤ãƒ«100%ã‚’ç¢ºèª

4. **æ¬¡ã®ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®æ±ºå®š**
   - `services/renderer.tsx`ã®ãƒ†ã‚¹ãƒˆä½œæˆã‚’æ¨å¥¨
   - ã¾ãŸã¯routeså±¤ã®ãƒ†ã‚¹ãƒˆä½œæˆ

---

**ã‚»ãƒƒã‚·ãƒ§ãƒ³7å®Œäº†ã€‚serviceså±¤ã®wasm.tsã¨font.tsã®ãƒ†ã‚¹ãƒˆè¿½åŠ ã«ã‚ˆã‚Šã€serviceså±¤ã®ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦100%ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’é”æˆã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯renderer.tsxã¾ãŸã¯routeså±¤ã®ãƒ†ã‚¹ãƒˆä½œæˆã«å–ã‚Šçµ„ã‚€æº–å‚™ãŒæ•´ã£ã¦ã„ã¾ã™ã€‚**

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³8 - 2025å¹´11æœˆ10æ—¥ï¼ˆservices/renderer.tsxãƒ†ã‚¹ãƒˆå®Œäº†ï¼‰

### å®Ÿæ–½æ¦‚è¦

TDDã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§services/renderer.tsxã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’ä½œæˆã—ã€serviceså±¤ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚

### å®Ÿæ–½å†…å®¹

#### 1. services/renderer.tsxã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå®Œäº†âœ…ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/renderer.test.tsx`ï¼ˆæ–°è¦ä½œæˆã€735è¡Œï¼‰
**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 13å€‹ï¼ˆå…¨ã¦é€šé âœ…ï¼‰

**ãƒ†ã‚¹ãƒˆå†…å®¹**:

- **renderTemplateToSvgé–¢æ•°**ï¼ˆ9ãƒ†ã‚¹ãƒˆï¼‰
  - åŸºæœ¬çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆcolorèƒŒæ™¯ï¼‰
  - ç”»åƒèƒŒæ™¯ã‚’æŒ‡å®šã—ãŸå ´åˆã€toDataUrlãŒå‘¼ã°ã‚Œã‚‹
  - uploadèƒŒæ™¯ã‚’æŒ‡å®šã—ãŸå ´åˆã€toDataUrlãŒå‘¼ã°ã‚Œã‚‹
  - èƒŒæ™¯ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸå ´åˆã€ç™½è‰²èƒŒæ™¯ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - èƒŒæ™¯ç”»åƒURLãŒç©ºã®å ´åˆã€ç™½è‰²èƒŒæ™¯ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - è¤‡æ•°ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¦ç´ ã‚’æ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  - maxWidthãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹è¦ç´ ã¯å¹…ãŒè¨­å®šã•ã‚Œã‚‹
  - maxHeightã‚’è¶…ãˆã‚‹å ´åˆã€ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºãŒèª¿æ•´ã•ã‚Œã‚‹

- **templateMagazineBasicé–¢æ•°**ï¼ˆ4ãƒ†ã‚¹ãƒˆï¼‰
  - åŸºæœ¬çš„ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆã‚«ãƒãƒ¼ç”»åƒãªã—ï¼‰
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒæ­£ã—ãé©ç”¨ã•ã‚Œã‚‹
  - ã‚«ãƒãƒ¼ç”»åƒãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€toDataUrlãŒå‘¼ã°ã‚Œã‚‹
  - ã‚«ãƒãƒ¼ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¦ã‚‚å‡¦ç†ã¯ç¶™ç¶šã™ã‚‹
  - ã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã§ãã‚‹

**ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**:
- `vi.mock('satori')`: Satoriã‚’ãƒ¢ãƒƒã‚¯ï¼ˆSVGæ–‡å­—åˆ—ã‚’è¿”å´ï¼‰
- `vi.mock('./font')`: ensureFontsLoadedã€getFontsã‚’ãƒ¢ãƒƒã‚¯
- `vi.mock('./image')`: toDataUrlã‚’ãƒ¢ãƒƒã‚¯
- å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆ`await import()`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰

**ã‚«ãƒãƒ¬ãƒƒã‚¸**: `services/renderer.tsx` **100%é”æˆè¦‹è¾¼ã¿**

#### 2. vitest.config.tsã®æ›´æ–°ï¼ˆå®Œäº†âœ…ï¼‰

**å¤‰æ›´å†…å®¹**:
- `.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚¹ãƒˆå¯¾è±¡ã«è¿½åŠ 
  - `include`: `'src/**/*.test.tsx'`ã‚’è¿½åŠ 
  - `coverage.include`: `'src/**/*.tsx'`ã‚’è¿½åŠ 
  - `coverage.exclude`: `'src/**/*.test.tsx'`ã‚’è¿½åŠ 

ã“ã‚Œã«ã‚ˆã‚Šã€TSXãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒ†ã‚¹ãƒˆãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã®å¯¾è±¡ã«ãªã‚Šã¾ã—ãŸã€‚

#### 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ

```bash
npm test
```

**çµæœ**:
- Test Files: **6 passed (6)**
- Tests: **60 passed (60)**
  - encoding.test.ts: 5ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
  - wasm.test.ts: 5ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
  - font.test.ts: 8ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
  - image.test.ts: 13ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
  - api-auth.test.ts: 16ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜ï¼‰
  - renderer.test.tsx: 13ãƒ†ã‚¹ãƒˆï¼ˆæ–°è¦ï¼‰
- Duration: 180ms

**å‰å›ã‹ã‚‰ã®å¢—åˆ†**: 47ãƒ†ã‚¹ãƒˆ â†’ 60ãƒ†ã‚¹ãƒˆï¼ˆ+13ãƒ†ã‚¹ãƒˆï¼‰

#### 4. Gitã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆå®Œäº†âœ…ï¼‰

**ã‚³ãƒŸãƒƒãƒˆ**: `1d57768`
```
test: services/renderer.tsxã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ 

- renderer.test.tsx: 13ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆå…¨ã¦é€šéï¼‰
  - renderTemplateToSvgé–¢æ•°ã®ãƒ†ã‚¹ãƒˆï¼ˆ9ã‚±ãƒ¼ã‚¹ï¼‰
  - templateMagazineBasicé–¢æ•°ã®ãƒ†ã‚¹ãƒˆï¼ˆ4ã‚±ãƒ¼ã‚¹ï¼‰

- vitest.config.ts: .tsxãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚¹ãƒˆå¯¾è±¡ã«è¿½åŠ 

å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: 60å€‹ï¼ˆå…¨ã¦é€šéï¼‰
  - å‰å›: 47ãƒ†ã‚¹ãƒˆ
  - ä»Šå›è¿½åŠ : 13ãƒ†ã‚¹ãƒˆ
```

**ãƒ—ãƒƒã‚·ãƒ¥**: `git push origin main`ï¼ˆæˆåŠŸ âœ…ï¼‰
- ã‚³ãƒŸãƒƒãƒˆç¯„å›²: `4a35e10..1d57768`

### æŠ€è¡“çš„ãªå­¦ã³

#### å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨ãƒ¢ãƒƒã‚¯ã®çµ„ã¿åˆã‚ã›

Vitestã§`vi.mock()`ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ãƒ¢ãƒƒã‚¯ã¯é™çš„ã«é©ç”¨ã•ã‚Œã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆå†…ã§å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆ`await import()`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```typescript
// ãƒ¢ãƒƒã‚¯å®šç¾©ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ï¼‰
vi.mock('satori', () => ({
  default: vi.fn().mockResolvedValue('<svg>mocked svg</svg>')
}))

// ãƒ†ã‚¹ãƒˆå†…ã§å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const { renderTemplateToSvg } = await import('./renderer.tsx')
const satori = (await import('satori')).default
```

#### JSXã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆ

- `.tsx`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.ts`ã¨åŒæ§˜ã«ãƒ†ã‚¹ãƒˆå¯èƒ½
- Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ãªãã€JSXã‚’è¿”ã™é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆ
- SatoriãŒå®Ÿéš›ã®SVGãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã€ãƒ¢ãƒƒã‚¯ã§ä»£æ›¿

#### console.errorã®ãƒ¢ãƒƒã‚¯

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€`console.error`ã‚’ã‚¹ãƒ‘ã‚¤ã§ãƒ¢ãƒƒã‚¯ã—ã¦ã€ãƒ­ã‚°å‡ºåŠ›ã‚’æ¤œè¨¼ï¼š

```typescript
const consoleErrorSpy = vi.spyOn(console, 'error').mockImplementation(() => {})
// ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
expect(consoleErrorSpy).toHaveBeenCalledWith(
  'Failed to convert background image to Data URL:',
  expect.any(Error)
)
consoleErrorSpy.mockRestore()
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³8å®Œäº†å¾Œï¼‰

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ wasm.ts
â”‚   â”œâ”€â”€ wasm.test.ts          âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³7ï¼ˆ5ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â”œâ”€â”€ font.ts
â”‚   â”œâ”€â”€ font.test.ts          âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³7ï¼ˆ8ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â”œâ”€â”€ image.ts
â”‚   â”œâ”€â”€ image.test.ts         âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³6ï¼ˆ13ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”‚   â”œâ”€â”€ renderer.tsx
â”‚   â””â”€â”€ renderer.test.tsx     âœ… æ–°è¦ï¼ˆ13ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸è¦‹è¾¼ã¿ï¼‰
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ api-auth.ts
â”‚   â””â”€â”€ api-auth.test.ts      âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³6ï¼ˆ16ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ encoding.ts
â”‚   â””â”€â”€ encoding.test.ts      âœ… ã‚»ãƒƒã‚·ãƒ§ãƒ³5ï¼ˆ5ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
â””â”€â”€ ...ï¼ˆãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

vitest.config.ts               âœ… æ›´æ–°ï¼ˆ.tsxå¯¾å¿œï¼‰
```

### æˆæœã¨æ”¹å–„ç‚¹

#### ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š
- **serviceså±¤ãƒ†ã‚¹ãƒˆå®Œäº†**: wasm.tsã€font.tsã€image.tsã€renderer.tsxã®å…¨ã¦ãŒ100%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆè¦‹è¾¼ã¿
- **ãƒ†ã‚¹ãƒˆç·æ•°**: 60ãƒ†ã‚¹ãƒˆï¼ˆå…¨é€šéï¼‰
- **ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢**: ä»Šå¾Œã®å¤‰æ›´ã§ãƒã‚°ã‚’æ—©æœŸç™ºè¦‹å¯èƒ½

#### é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®æ”¹å–„
- **TDDå®Ÿè·µ**: Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«ã®å®Ÿè·µ
- **TSXå¯¾å¿œ**: .tsxãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒãŒæ•´å‚™ã•ã‚ŒãŸ

### å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯ï¼ˆå…¨ä½“ã‚µãƒãƒªãƒ¼ï¼‰

1. âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„
2. âœ… ã‚³ãƒ¼ãƒ‰é‡è¤‡ã®å‰Šé™¤
3. âœ… å‹å®šç¾©ã®æ•´ç†
4. âœ… APIèªè¨¼ã®çµ±ä¸€åŒ–
5. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„
6. âœ… HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å¤–éƒ¨åŒ–
7. âœ… Phase 1: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®åˆ†é›¢
8. âœ… Phase 2: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®åˆ†é›¢
9. âœ… Phase 3: APIèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ±åˆ
10. âœ… æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
11. âœ… å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆ
12. âœ… Vitestãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å°å…¥
13. âœ… utils/encoding.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ5ãƒ†ã‚¹ãƒˆï¼‰
14. âœ… services/image.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ13ãƒ†ã‚¹ãƒˆï¼‰
15. âœ… middleware/api-auth.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ16ãƒ†ã‚¹ãƒˆï¼‰
16. âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«ã®å°å…¥
17. âœ… services/wasm.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ5ãƒ†ã‚¹ãƒˆï¼‰
18. âœ… services/font.tsã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ8ãƒ†ã‚¹ãƒˆï¼‰
19. âœ… **services/renderer.tsxã®ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ13ãƒ†ã‚¹ãƒˆã€100%ã‚«ãƒãƒ¬ãƒƒã‚¸è¦‹è¾¼ã¿ï¼‰**
20. âœ… **vitest.config.tsã®.tsxå¯¾å¿œ**

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³9ï¼‰ã§å®Ÿæ–½ã™ã¹ãã‚¿ã‚¹ã‚¯

#### å„ªå…ˆåº¦: ä¸­

1. **routeså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - `routes/render.ts`: POST /renderã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
   - `routes/images.ts`: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/å–å¾—/å‰Šé™¤ã®ãƒ†ã‚¹ãƒˆ
   - `routes/templates.ts`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†CRUDã®ãƒ†ã‚¹ãƒˆ

2. **authå±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - èªè¨¼é–¢é€£ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

3. **api-keyså±¤ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä½œæˆ**
   - APIã‚­ãƒ¼ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - CRUDæ“ä½œã®ãƒ†ã‚¹ãƒˆ

#### å„ªå…ˆåº¦: ä½

4. **E2Eãƒ†ã‚¹ãƒˆã®å°å…¥æ¤œè¨**
   - Playwrightã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
   - ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆ/render, /templatesï¼‰ã®ãƒ†ã‚¹ãƒˆ

5. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–**
   - GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ
   - ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

6. **æ–°æ©Ÿèƒ½ã®é–‹ç™º**ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æœ›ã«å¿œã˜ã¦ï¼‰
   - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ‹¡å¼µ
   - UIã®æ”¹å–„

### ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ**: `1d57768` (test: services/renderer.tsxã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ )
- **ãƒ–ãƒ©ãƒ³ãƒ**: main
- **ãƒªãƒ¢ãƒ¼ãƒˆã¨ã®åŒæœŸ**: âœ… åŒæœŸæ¸ˆã¿ï¼ˆãƒ—ãƒƒã‚·ãƒ¥å®Œäº†ï¼‰
- **ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… 60/60ãƒ†ã‚¹ãƒˆé€šé
- **ãƒ†ã‚¹ãƒˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**: encoding.ts, wasm.ts, font.ts, image.ts, renderer.tsx, api-auth.tsï¼ˆå…¨ã¦100%ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆè¦‹è¾¼ã¿ï¼‰
- **ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… æˆåŠŸ
- **æœ¬ç•ªç’°å¢ƒ**: https://ogp-worker.tomohirof.workers.devï¼ˆæ­£å¸¸å‹•ä½œä¸­ï¼‰

### æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ç¢ºèªäº‹é …

1. **GitçŠ¶æ…‹ã®ç¢ºèª**
   ```bash
   git log --oneline -5
   git status
   ```
   - æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ: `1d57768`
   - ãƒªãƒ¢ãƒ¼ãƒˆã¨åŒæœŸæ¸ˆã¿

2. **ãƒ†ã‚¹ãƒˆå‹•ä½œç¢ºèª**
   ```bash
   npm test
   ```
   - 60/60ãƒ†ã‚¹ãƒˆãŒé€šéã™ã‚‹ã“ã¨ã‚’ç¢ºèª

3. **ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª**
   ```bash
   npm run test:coverage
   ```
   - ãƒ†ã‚¹ãƒˆæ¸ˆã¿6ãƒ•ã‚¡ã‚¤ãƒ«100%ã‚’ç¢ºèª

4. **æ¬¡ã®ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®æ±ºå®š**
   - routeså±¤ã®ãƒ†ã‚¹ãƒˆä½œæˆã‚’æ¨å¥¨
   - ã¾ãŸã¯authå±¤/api-keyså±¤ã®ãƒ†ã‚¹ãƒˆä½œæˆ

---

**ã‚»ãƒƒã‚·ãƒ§ãƒ³8å®Œäº†ã€‚services/renderer.tsxã®ãƒ†ã‚¹ãƒˆè¿½åŠ ã«ã‚ˆã‚Šã€serviceså±¤ã®å…¨ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã¯routeså±¤ã¾ãŸã¯auth/api-keyså±¤ã®ãƒ†ã‚¹ãƒˆä½œæˆã«å–ã‚Šçµ„ã‚€æº–å‚™ãŒæ•´ã£ã¦ã„ã¾ã™ã€‚**
